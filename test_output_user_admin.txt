=== RUN   TestRegister
[GIN] 2026/01/14 - 07:56:56 | 201 |     48.7077ms |                 | POST     "/register"

2026/01/14 07:56:56 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("9862ad06-3513-4352-b7a5-18c35498d17a","john@example.com","johndoe","$2a$10$QWGaom7BiIOOVw9GC8wkGeYZ8Q/3BjbHtZoGtsQC50ibIC7DSoK7O","John Doe","","user",false,"2026-01-14 07:56:56.339","2026-01-14 07:56:56.339","2026-01-14 07:56:56.339")
[GIN] 2026/01/14 - 07:56:56 | 409 |     54.8197ms |                 | POST     "/register"
--- PASS: TestRegister (0.11s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:56:56 | 200 |     47.7103ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:56:56 | 401 |        49.9ms |                 | POST     "/login"
--- PASS: TestLogin (0.15s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:56:56 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:56:56 | 200 |     51.5367ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:56:56 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:56:56 | 200 |     51.5399ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:56:56 | 403 |         850â”¬â•¡s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:56:56 | 200 |     48.0326ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:56:56 | 200 |       955.5â”¬â•¡s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.16s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:56:56 | 200 |      50.029ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:56:56 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "7250e1f8-9616-45fb-94dd-b219b4f23ada" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:56:56 | 200 |       319.6â”¬â•¡s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:56:56 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:56:56 | 200 |     48.5953ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:56:56 | 401 |      47.298ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:56:57 | 200 |     98.8222ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:56:57 | 200 |     49.3771ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.29s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:56:57 | 200 |     48.3187ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | PUT      "/admin/users/1d62804d-d714-485d-b326-71b8f36b05ac/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:56:57 | 200 |     52.1904ms |                 | POST     "/admin/users/1d62804d-d714-485d-b326-71b8f36b05ac/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | DELETE   "/admin/users/1d62804d-d714-485d-b326-71b8f36b05ac"

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "1d62804d-d714-485d-b326-71b8f36b05ac" AND `users`.`id` = "1d62804d-d714-485d-b326-71b8f36b05ac" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.16s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:56:57 | 201 |      1.0002ms |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:56:57 | 201 |       502.1â”¬â•¡s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | GET      "/boards/c71e6e87-8a7c-4ffb-8cf1-4a28bce9649c"

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:229 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "438ec03e-e372-4438-afe8-25b889d0a998" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:56:57 | 404 |       325.8â”¬â•¡s |                 | GET      "/boards/438ec03e-e372-4438-afe8-25b889d0a998"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | PUT      "/boards/5cd7ea24-81e7-49b9-bb18-3ad132009ad2/status"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | PUT      "/boards/5cd7ea24-81e7-49b9-bb18-3ad132009ad2/status"
--- PASS: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | PUT      "/boards/e5ff7ca2-1c1a-408d-8666-82a8bfdd12a8"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board 77483cb4-d934-4e21-87f5-13579a0efad5.
[GIN] 2026/01/14 - 07:56:57 | 200 |       536.9â”¬â•¡s |                 | POST     "/boards/77483cb4-d934-4e21-87f5-13579a0efad5/join"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/boards/77483cb4-d934-4e21-87f5-13579a0efad5/leave"
[GIN] 2026/01/14 - 07:56:57 | 400 |            0s |                 | POST     "/boards/77483cb4-d934-4e21-87f5-13579a0efad5/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/boards/6fb02e01-33fe-4652-81ad-21d3ee9937ef/claim"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/boards/6fb02e01-33fe-4652-81ad-21d3ee9937ef/claim"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/boards/6fb02e01-33fe-4652-81ad-21d3ee9937ef/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | DELETE   "/boards/059a280d-56e8-49da-a353-5a5119c8a350"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestColumnCRUD
[GIN] 2026/01/14 - 07:56:57 | 201 |            0s |                 | POST     "/boards/278c7e91-5715-4bb9-9710-0f104d148b24/columns"
[GIN] 2026/01/14 - 07:56:57 | 200 |       858.6â”¬â•¡s |                 | PUT      "/columns/9d011081-29c2-4264-8f64-29ece2b65dcc"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | PUT      "/columns/9d011081-29c2-4264-8f64-29ece2b65dcc/position"
[GIN] 2026/01/14 - 07:56:57 | 201 |            0s |                 | POST     "/boards/278c7e91-5715-4bb9-9710-0f104d148b24/columns"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | DELETE   "/columns/9d011081-29c2-4264-8f64-29ece2b65dcc"
--- PASS: TestColumnCRUD (0.00s)
=== RUN   TestCardCRUD
[GIN] 2026/01/14 - 07:56:57 | 201 |            0s |                 | POST     "/columns/f2e15715-ce91-4686-ae02-0f956cd48323/cards"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | PUT      "/cards/a3879d08-43db-4baf-916f-82f294ee3472"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | DELETE   "/cards/a3879d08-43db-4baf-916f-82f294ee3472"
--- PASS: TestCardCRUD (0.00s)
=== RUN   TestMoveCard
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | PUT      "/cards/a397c37b-f9de-456c-8010-39fa4eb8453a/move"
--- PASS: TestMoveCard (0.00s)
=== RUN   TestMergeAndUnmergeCard
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/cards/6c3c7849-23cb-43ab-a7c1-46bcc27577af/merge"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/cards/6c3c7849-23cb-43ab-a7c1-46bcc27577af/unmerge"
--- PASS: TestMergeAndUnmergeCard (0.00s)
=== RUN   TestSadPaths
[GIN] 2026/01/14 - 07:56:57 | 400 |            0s |       192.0.2.1 | PUT      "/columns/invalid-uuid"

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/column_handler.go:75 [35;1mrecord not found
[0m[33m[0.514ms] [34;1m[rows:0][0m SELECT * FROM `columns` WHERE `columns`.`id` = "58c664be-6d15-42a9-9007-9a86d5d98539" AND `columns`.`deleted_at` IS NULL ORDER BY `columns`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:56:57 | 404 |         514â”¬â•¡s |       192.0.2.1 | PUT      "/columns/58c664be-6d15-42a9-9007-9a86d5d98539"

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/card_handler.go:171 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `cards` WHERE `cards`.`id` = "094d144e-6702-46e9-871d-c45fb8eaf178" AND `cards`.`deleted_at` IS NULL ORDER BY `cards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:56:57 | 404 |            0s |                 | POST     "/cards/ec2a0269-fff6-4d6d-b86d-5485b931b3cc/merge"
--- PASS: TestSadPaths (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.09s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.10s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.09s)
=== RUN   TestSearchUsers
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=Alic"
[GIN] 2026/01/14 - 07:56:57 | 200 |       729.9â”¬â•¡s |       192.0.2.1 | GET      "/users/search?q=bob@"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=a"
--- PASS: TestSearchUsers (0.00s)
=== RUN   TestAdminLogin
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/admin/login"
[GIN] 2026/01/14 - 07:56:57 | 401 |            0s |                 | POST     "/admin/login"
--- PASS: TestAdminLogin (0.00s)
=== RUN   TestAdminUpdateBoardSettings
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | PUT      "/admin/boards/525afb24-e94d-443f-bfc3-4bc60c7e1440/settings"
--- PASS: TestAdminUpdateBoardSettings (0.00s)
=== RUN   TestGetSystemStats
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |       192.0.2.1 | GET      "/admin/stats"
--- PASS: TestGetSystemStats (0.00s)
=== RUN   TestVoteFlow

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "5094d7d5-1577-452e-93e8-49b36de04991" AND user_name = "user1" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:56:57 | 201 |       461.2â”¬â•¡s |                 | POST     "/cards/5094d7d5-1577-452e-93e8-49b36de04991/votes"
[GIN] 2026/01/14 - 07:56:57 | 400 |            0s |                 | POST     "/cards/5094d7d5-1577-452e-93e8-49b36de04991/votes"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |                 | POST     "/cards/5094d7d5-1577-452e-93e8-49b36de04991/votes"

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "5094d7d5-1577-452e-93e8-49b36de04991" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:56:57 | 201 |            0s |       192.0.2.1 | POST     "/cards/5094d7d5-1577-452e-93e8-49b36de04991/votes"

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "93d0c424-13ff-423e-a7b1-a2f8cc45a1e4" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:56:57 | 403 |       502.5â”¬â•¡s |       192.0.2.1 | POST     "/cards/93d0c424-13ff-423e-a7b1-a2f8cc45a1e4/votes"
--- PASS: TestVoteFlow (0.00s)
=== RUN   TestGetVotesBlind
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |       192.0.2.1 | GET      "/cards/e1d125c1-7e85-4b00-8e9c-308a782bd8ea/votes?user=me"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |       192.0.2.1 | GET      "/cards/e1d125c1-7e85-4b00-8e9c-308a782bd8ea/votes?user=me"
--- PASS: TestGetVotesBlind (0.00s)
=== RUN   TestReactionFlow

2026/01/14 07:56:57 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/reaction_handler.go:39 [35;1mrecord not found
[0m[33m[0.508ms] [34;1m[rows:0][0m SELECT * FROM `reactions` WHERE (card_id = "34ef7932-9d82-4ae3-9abe-8c21f47f15c3" AND user_name = "user1" AND reaction_type = "love") AND `reactions`.`deleted_at` IS NULL ORDER BY `reactions`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:56:57 | 200 |       508.4â”¬â•¡s |                 | POST     "/cards/34ef7932-9d82-4ae3-9abe-8c21f47f15c3/reactions"
[GIN] 2026/01/14 - 07:56:57 | 200 |            0s |       192.0.2.1 | POST     "/cards/34ef7932-9d82-4ae3-9abe-8c21f47f15c3/reactions"
[GIN] 2026/01/14 - 07:56:57 | 400 |            0s |       192.0.2.1 | POST     "/cards/34ef7932-9d82-4ae3-9abe-8c21f47f15c3/reactions"
--- PASS: TestReactionFlow (0.00s)
PASS
ok  	retro-app/internal/handlers	1.523s
