=== RUN   TestRegister
[GIN] 2026/01/14 - 07:39:37 | 201 |     54.5521ms |                 | POST     "/register"

2026/01/14 07:39:37 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("9bcdddd5-0360-4e8d-8e13-3e0d0572548e","john@example.com","johndoe","$2a$10$FsOnZy821tb3nUjixJteD./CUxC6xiWu0a9Lnr8g0G5M1awsYkwp.","John Doe","","user",false,"2026-01-14 07:39:37.662","2026-01-14 07:39:37.662","2026-01-14 07:39:37.662")
[GIN] 2026/01/14 - 07:39:37 | 409 |     51.3852ms |                 | POST     "/register"
--- PASS: TestRegister (0.11s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:39:37 | 200 |     49.7736ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:39:37 | 401 |     49.2918ms |                 | POST     "/login"
--- PASS: TestLogin (0.15s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:39:37 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:39:37 | 200 |     47.6226ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:39:37 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:39:38 | 200 |     48.9245ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:39:38 | 403 |            0s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:39:38 | 200 |      48.133ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:39:38 | 200 |       592.7â”¬â•¡s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.15s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:39:38 | 200 |     62.7536ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:39:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "828598f8-fc88-4967-92c8-b336509eb89c" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:39:38 | 200 |       638.6â”¬â•¡s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:39:38 | 409 |       503.6â”¬â•¡s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.11s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:39:38 | 200 |     60.5322ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:39:38 | 401 |     50.1669ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:39:38 | 200 |     95.8562ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:39:38 | 200 |      46.252ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.30s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:39:38 | 200 |     45.5085ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | PUT      "/admin/users/3dcb9db4-73d6-4c3a-a6d5-74b9ba7028ab/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:39:38 | 200 |     48.0879ms |                 | POST     "/admin/users/3dcb9db4-73d6-4c3a-a6d5-74b9ba7028ab/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:39:38 | 200 |      1.0825ms |                 | DELETE   "/admin/users/3dcb9db4-73d6-4c3a-a6d5-74b9ba7028ab"

2026/01/14 07:39:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "3dcb9db4-73d6-4c3a-a6d5-74b9ba7028ab" AND `users`.`id` = "3dcb9db4-73d6-4c3a-a6d5-74b9ba7028ab" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.14s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:39:38 | 201 |            0s |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:39:38 | 201 |            0s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:39:38 | 200 |       511.9â”¬â•¡s |                 | GET      "/boards/2194d85a-07dc-42db-9d8b-f5331b5d44d7"

2026/01/14 07:39:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:234 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "08c343be-88d3-496f-8d2d-3b42da0e0b18" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:39:38 | 404 |            0s |                 | GET      "/boards/08c343be-88d3-496f-8d2d-3b42da0e0b18"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | PUT      "/boards/178ef68f-a005-4651-b8a1-21a2ce8c272b/status"
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | PUT      "/boards/178ef68f-a005-4651-b8a1-21a2ce8c272b/status"
    board_handler_test.go:179: 
        	Error Trace:	C:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler_test.go:179
        	Error:      	Expected nil, but got: time.Date(2026, time.January, 14, 7, 39, 38, 624683600, time.Location(""))
        	Test:       	TestUpdateBoardStatus
--- FAIL: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | PUT      "/boards/eff11224-262e-451d-9950-6dbebfe4a512"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board 6afb419c-077a-485a-97c0-a7e5e457b699.
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | POST     "/boards/6afb419c-077a-485a-97c0-a7e5e457b699/join"
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | POST     "/boards/6afb419c-077a-485a-97c0-a7e5e457b699/leave"
[GIN] 2026/01/14 - 07:39:38 | 400 |            0s |                 | POST     "/boards/6afb419c-077a-485a-97c0-a7e5e457b699/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | POST     "/boards/2f7b8d50-beb1-4a75-9d75-316704b4cafc/claim"
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | POST     "/boards/2f7b8d50-beb1-4a75-9d75-316704b4cafc/claim"
[GIN] 2026/01/14 - 07:39:38 | 200 |       503.8â”¬â•¡s |                 | POST     "/boards/2f7b8d50-beb1-4a75-9d75-316704b4cafc/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:39:38 | 200 |            0s |                 | DELETE   "/boards/2297a15d-80e3-4b03-bd11-3e024054caf4"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:39:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.625ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.10s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.10s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:39:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
FAIL
FAIL	retro-app/internal/handlers	1.503s
FAIL
