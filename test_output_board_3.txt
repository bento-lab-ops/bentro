=== RUN   TestRegister
[GIN] 2026/01/14 - 07:40:36 | 201 |     56.9594ms |                 | POST     "/register"

2026/01/14 07:40:37 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[1.534ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("0f9963db-491e-4048-b2a8-da230f12f93d","john@example.com","johndoe","$2a$10$N8GhOYFglW4ZKV4urOOzee/zKhcJcut52twJull126hJBbe.KmlMm","John Doe","","user",false,"2026-01-14 07:40:37.026","2026-01-14 07:40:37.028","2026-01-14 07:40:37.028")
[GIN] 2026/01/14 - 07:40:37 | 409 |     53.7227ms |                 | POST     "/register"
--- PASS: TestRegister (0.12s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:40:37 | 200 |     56.5428ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:40:37 | 401 |     50.9948ms |                 | POST     "/login"
--- PASS: TestLogin (0.16s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:40:37 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:40:37 | 200 |     54.8599ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:40:37 | 200 |       452.5â”¬â•¡s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.11s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:40:37 | 200 |     49.1182ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:40:37 | 403 |            0s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:40:37 | 200 |      47.959ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:40:37 | 200 |            0s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.15s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:40:37 | 200 |     55.4662ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:40:37 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "d45a4eb6-33fe-4eb5-aab6-543701f4340e" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:40:37 | 200 |            0s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:40:37 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.11s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:40:37 | 200 |     56.1472ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:40:37 | 401 |     59.0089ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:40:37 | 200 |    103.4229ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:40:37 | 200 |     50.1682ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.32s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:40:37 | 200 |     57.4153ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:40:38 | 200 |       502.8â”¬â•¡s |                 | PUT      "/admin/users/4f3b7550-abda-4049-a674-db3e907dcac3/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:40:38 | 200 |     55.7821ms |                 | POST     "/admin/users/4f3b7550-abda-4049-a674-db3e907dcac3/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | DELETE   "/admin/users/4f3b7550-abda-4049-a674-db3e907dcac3"

2026/01/14 07:40:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "4f3b7550-abda-4049-a674-db3e907dcac3" AND `users`.`id` = "4f3b7550-abda-4049-a674-db3e907dcac3" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.17s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:40:38 | 201 |            0s |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:40:38 | 201 |            0s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | GET      "/boards/87d7db02-4d2e-44f5-99db-20378dc157d5"

2026/01/14 07:40:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:229 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "b793f533-2df6-4eb8-9f0e-097078de1679" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:40:38 | 404 |            0s |                 | GET      "/boards/b793f533-2df6-4eb8-9f0e-097078de1679"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 07:40:38 | 200 |       537.5â”¬â•¡s |                 | PUT      "/boards/fb44262b-5ede-436f-9799-0e5ec92a0eef/status"
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | PUT      "/boards/fb44262b-5ede-436f-9799-0e5ec92a0eef/status"
    board_handler_test.go:179: 
        	Error Trace:	C:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler_test.go:179
        	Error:      	Expected nil, but got: time.Date(2026, time.January, 14, 7, 40, 38, 65839400, time.Location(""))
        	Test:       	TestUpdateBoardStatus
--- FAIL: TestUpdateBoardStatus (0.01s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | PUT      "/boards/c14c3dfc-2c50-4093-8ebe-4ae1619d06b9"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board 8ed5a716-2006-482e-bba8-5fe101cae388.
[GIN] 2026/01/14 - 07:40:38 | 200 |       563.1â”¬â•¡s |                 | POST     "/boards/8ed5a716-2006-482e-bba8-5fe101cae388/join"
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | POST     "/boards/8ed5a716-2006-482e-bba8-5fe101cae388/leave"
[GIN] 2026/01/14 - 07:40:38 | 400 |       505.1â”¬â•¡s |                 | POST     "/boards/8ed5a716-2006-482e-bba8-5fe101cae388/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | POST     "/boards/3ef60d4d-57e6-4975-9825-c77560aeb71b/claim"
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | POST     "/boards/3ef60d4d-57e6-4975-9825-c77560aeb71b/claim"
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | POST     "/boards/3ef60d4d-57e6-4975-9825-c77560aeb71b/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:40:38 | 200 |            0s |                 | DELETE   "/boards/228acc90-afad-4ce4-ac5f-e61117e6f039"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:40:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.10s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.10s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:40:38 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
FAIL
FAIL	retro-app/internal/handlers	1.606s
FAIL
