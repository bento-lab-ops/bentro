=== RUN   TestRegister
[GIN] 2026/01/14 - 08:02:52 | 201 |     54.5499ms |                 | POST     "/register"

2026/01/14 08:02:52 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("d35720e1-ece8-49b8-9d96-47bc3a85fea4","john@example.com","johndoe","$2a$10$5WrcRfzPbU39xRgE5T0.x.D3Z05H5tXENQMdnbyrBoVR60hhhMPEm","John Doe","","user",false,"2026-01-14 08:02:52.094","2026-01-14 08:02:52.094","2026-01-14 08:02:52.094")
[GIN] 2026/01/14 - 08:02:52 | 409 |     53.4019ms |                 | POST     "/register"
--- PASS: TestRegister (0.11s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 08:02:52 | 200 |     49.0324ms |                 | POST     "/login"
[GIN] 2026/01/14 - 08:02:52 | 401 |     56.7211ms |                 | POST     "/login"
--- PASS: TestLogin (0.16s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 08:02:52 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 08:02:52 | 200 |     47.1566ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 08:02:52 | 200 |       697.6â”¬â•¡s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 08:02:52 | 200 |     47.0131ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 08:02:52 | 403 |       502.3â”¬â•¡s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 08:02:52 | 200 |     48.4846ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 08:02:52 | 200 |            0s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.16s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 08:02:52 | 200 |     48.6571ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 08:02:52 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "ca80ff18-25d1-4dc5-bf23-22d2e09c27b7" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:02:52 | 200 |            0s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 08:02:52 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 08:02:52 | 200 |     53.2378ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 08:02:52 | 401 |     47.7344ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 08:02:52 | 200 |    111.9151ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 08:02:52 | 200 |     57.0526ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.32s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 08:02:53 | 200 |     49.5839ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 08:02:53 | 200 |       640.5â”¬â•¡s |                 | PUT      "/admin/users/953f4626-b7f2-4af5-a27a-70bb71fd4a36/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 08:02:53 | 200 |      49.115ms |                 | POST     "/admin/users/953f4626-b7f2-4af5-a27a-70bb71fd4a36/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 08:02:53 | 200 |      1.0164ms |                 | DELETE   "/admin/users/953f4626-b7f2-4af5-a27a-70bb71fd4a36"

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "953f4626-b7f2-4af5-a27a-70bb71fd4a36" AND `users`.`id` = "953f4626-b7f2-4af5-a27a-70bb71fd4a36" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.15s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 08:02:53 | 201 |         563â”¬â•¡s |                 | POST     "/boards"
[GIN] 2026/01/14 - 08:02:53 | 201 |            0s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | GET      "/boards/917ae14d-9cd8-401a-bd0d-4b3ba70ec778"

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:229 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "5bb2e6a5-c329-4e54-bf91-88945c88a081" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:02:53 | 404 |            0s |                 | GET      "/boards/5bb2e6a5-c329-4e54-bf91-88945c88a081"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/boards/169bdccc-d7ff-4cec-bff0-202bee34474f/status"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/boards/169bdccc-d7ff-4cec-bff0-202bee34474f/status"
--- PASS: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/boards/0581b83d-cab5-45b0-b542-b2715eaea3d5"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board f76e6c23-62bd-4206-8fe9-58e5d6142618.
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/boards/f76e6c23-62bd-4206-8fe9-58e5d6142618/join"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/boards/f76e6c23-62bd-4206-8fe9-58e5d6142618/leave"
[GIN] 2026/01/14 - 08:02:53 | 400 |            0s |                 | POST     "/boards/f76e6c23-62bd-4206-8fe9-58e5d6142618/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/boards/04b820c8-2fcd-4a49-80a5-548e3f5f1ce7/claim"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/boards/04b820c8-2fcd-4a49-80a5-548e3f5f1ce7/claim"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/boards/04b820c8-2fcd-4a49-80a5-548e3f5f1ce7/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 08:02:53 | 200 |       508.1â”¬â•¡s |                 | DELETE   "/boards/d73ff9f3-389a-44e8-8189-e352cef77272"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestColumnCRUD
[GIN] 2026/01/14 - 08:02:53 | 201 |            0s |                 | POST     "/boards/9e1e49a4-ce8f-436b-9f16-bd7790e4e58d/columns"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/columns/3f7c4b89-eb56-4c31-8c16-cded97cd06bd"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/columns/3f7c4b89-eb56-4c31-8c16-cded97cd06bd/position"
[GIN] 2026/01/14 - 08:02:53 | 201 |            0s |                 | POST     "/boards/9e1e49a4-ce8f-436b-9f16-bd7790e4e58d/columns"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | DELETE   "/columns/3f7c4b89-eb56-4c31-8c16-cded97cd06bd"
--- PASS: TestColumnCRUD (0.00s)
=== RUN   TestCardCRUD
[GIN] 2026/01/14 - 08:02:53 | 201 |            0s |                 | POST     "/columns/f1fa2fa9-3bdb-4c76-93c6-28113a302051/cards"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/cards/605ccf15-68df-40aa-afaa-f651511d52e2"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | DELETE   "/cards/605ccf15-68df-40aa-afaa-f651511d52e2"
--- PASS: TestCardCRUD (0.00s)
=== RUN   TestMoveCard
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/cards/82517dfa-026f-4ffa-a752-8d82f95cafca/move"
--- PASS: TestMoveCard (0.00s)
=== RUN   TestMergeAndUnmergeCard
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/cards/2a1eeef8-23ad-4d7f-ad1b-a4952d3211d1/merge"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/cards/2a1eeef8-23ad-4d7f-ad1b-a4952d3211d1/unmerge"
--- PASS: TestMergeAndUnmergeCard (0.00s)
=== RUN   TestSadPaths
[GIN] 2026/01/14 - 08:02:53 | 400 |            0s |       192.0.2.1 | PUT      "/columns/invalid-uuid"

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/column_handler.go:75 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `columns` WHERE `columns`.`id` = "e0928ed0-db90-437f-acc2-7a38c88d8110" AND `columns`.`deleted_at` IS NULL ORDER BY `columns`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:02:53 | 404 |            0s |       192.0.2.1 | PUT      "/columns/e0928ed0-db90-437f-acc2-7a38c88d8110"

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/card_handler.go:171 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `cards` WHERE `cards`.`id` = "eb8a15f8-d70f-4c41-8c59-6001e1df06ff" AND `cards`.`deleted_at` IS NULL ORDER BY `cards`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:02:53 | 404 |            0s |                 | POST     "/cards/66fc8db9-9db3-4ed6-b37d-0e17d396f93f/merge"
--- PASS: TestSadPaths (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.11s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.10s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.508ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
=== RUN   TestTeamCRUD
[GIN] 2026/01/14 - 08:02:53 | 201 |            0s |                 | POST     "/teams"
[GIN] 2026/01/14 - 08:02:53 | 200 |       541.7â”¬â•¡s |                 | PUT      "/teams/65229e0e-d107-4798-b1e0-68891cc2d5d5"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | DELETE   "/teams/65229e0e-d107-4798-b1e0-68891cc2d5d5"
--- PASS: TestTeamCRUD (0.00s)
=== RUN   TestTeamMembership
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/teams/d1fabf0a-d6fa-4627-8cb2-1be78553257a/join"
[GIN] 2026/01/14 - 08:02:53 | 200 |         538â”¬â•¡s |                 | POST     "/teams/d1fabf0a-d6fa-4627-8cb2-1be78553257a/leave"
[GIN] 2026/01/14 - 08:02:53 | 403 |            0s |                 | POST     "/teams/d1fabf0a-d6fa-4627-8cb2-1be78553257a/join"
[GIN] 2026/01/14 - 08:02:53 | 201 |            0s |                 | POST     "/teams/d1fabf0a-d6fa-4627-8cb2-1be78553257a/members"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | DELETE   "/teams/d1fabf0a-d6fa-4627-8cb2-1be78553257a/members/45cb8ae2-0d41-4273-ab6e-95ea33d9cc4c"
--- PASS: TestTeamMembership (0.00s)
=== RUN   TestTeamRoles
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/teams/d3b959b4-626d-4580-aedd-d1410f0ef90f/members/cf3c034d-6eed-491c-9771-947867f01747/role"
--- PASS: TestTeamRoles (0.00s)
=== RUN   TestListTeams
[GIN] 2026/01/14 - 08:02:53 | 200 |       506.1â”¬â•¡s |                 | GET      "/teams/mine"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       192.0.2.1 | GET      "/teams"
--- PASS: TestListTeams (0.00s)
=== RUN   TestSearchUsers
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=Alic"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=bob@"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=a"
--- PASS: TestSearchUsers (0.00s)
=== RUN   TestAdminLogin
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/admin/login"
[GIN] 2026/01/14 - 08:02:53 | 401 |            0s |                 | POST     "/admin/login"
--- PASS: TestAdminLogin (0.00s)
=== RUN   TestAdminUpdateBoardSettings
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | PUT      "/admin/boards/5245a702-61e1-4744-ad29-0cf867bc3957/settings"
--- PASS: TestAdminUpdateBoardSettings (0.00s)
=== RUN   TestGetSystemStats
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       192.0.2.1 | GET      "/admin/stats"
--- PASS: TestGetSystemStats (0.00s)
=== RUN   TestVoteFlow

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "83bc9a4e-9400-4de4-ad4d-d9c019b47b3c" AND user_name = "user1" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:02:53 | 201 |            0s |                 | POST     "/cards/83bc9a4e-9400-4de4-ad4d-d9c019b47b3c/votes"
[GIN] 2026/01/14 - 08:02:53 | 400 |            0s |                 | POST     "/cards/83bc9a4e-9400-4de4-ad4d-d9c019b47b3c/votes"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/cards/83bc9a4e-9400-4de4-ad4d-d9c019b47b3c/votes"

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "83bc9a4e-9400-4de4-ad4d-d9c019b47b3c" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:02:53 | 201 |            0s |       192.0.2.1 | POST     "/cards/83bc9a4e-9400-4de4-ad4d-d9c019b47b3c/votes"

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "cc4575f8-1655-45fa-9afc-8cd2b4c0d1ff" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:02:53 | 403 |      1.0021ms |       192.0.2.1 | POST     "/cards/cc4575f8-1655-45fa-9afc-8cd2b4c0d1ff/votes"
--- PASS: TestVoteFlow (0.00s)
=== RUN   TestGetVotesBlind
[GIN] 2026/01/14 - 08:02:53 | 200 |       507.5â”¬â•¡s |       192.0.2.1 | GET      "/cards/8e7d643d-a40a-443f-acb9-40bbe5c9bff0/votes?user=me"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       192.0.2.1 | GET      "/cards/8e7d643d-a40a-443f-acb9-40bbe5c9bff0/votes?user=me"
--- PASS: TestGetVotesBlind (0.00s)
=== RUN   TestReactionFlow

2026/01/14 08:02:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/reaction_handler.go:39 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `reactions` WHERE (card_id = "b30963ac-a84f-46e4-b185-645f41045eee" AND user_name = "user1" AND reaction_type = "love") AND `reactions`.`deleted_at` IS NULL ORDER BY `reactions`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |                 | POST     "/cards/b30963ac-a84f-46e4-b185-645f41045eee/reactions"
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       192.0.2.1 | POST     "/cards/b30963ac-a84f-46e4-b185-645f41045eee/reactions"
[GIN] 2026/01/14 - 08:02:53 | 400 |            0s |       192.0.2.1 | POST     "/cards/b30963ac-a84f-46e4-b185-645f41045eee/reactions"
--- PASS: TestReactionFlow (0.00s)
=== RUN   TestWebSocketFlow
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       127.0.0.1 | GET      "/ws"
2026/01/14 08:02:53 Client connected. Total clients: 1
[GIN] 2026/01/14 - 08:02:53 | 200 |            0s |       127.0.0.1 | GET      "/ws"
2026/01/14 08:02:53 Client connected. Total clients: 2
--- PASS: TestWebSocketFlow (0.16s)
PASS
ok  	retro-app/internal/handlers	1.744s
