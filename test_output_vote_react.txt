=== RUN   TestRegister
[GIN] 2026/01/14 - 07:54:39 | 201 |     51.8339ms |                 | POST     "/register"

2026/01/14 07:54:39 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("a8e67391-5704-4fbe-b4c1-907e24d97930","john@example.com","johndoe","$2a$10$H4xeCdVoIMSLMaEl9TTql.gI6CIw.gXs4TECKyz4ruB3p01NCsU8G","John Doe","","user",false,"2026-01-14 07:54:39.759","2026-01-14 07:54:39.759","2026-01-14 07:54:39.759")
[GIN] 2026/01/14 - 07:54:39 | 409 |     48.6138ms |                 | POST     "/register"
--- PASS: TestRegister (0.10s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:54:39 | 200 |      52.484ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:54:39 | 401 |     47.1866ms |                 | POST     "/login"
--- PASS: TestLogin (0.15s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:54:39 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:54:40 | 200 |     48.7054ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:54:40 | 200 |     51.1991ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:54:40 | 403 |            0s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:54:40 | 200 |     50.0289ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:54:40 | 200 |       301.5â”¬â•¡s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.15s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:54:40 | 200 |     46.9749ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:54:40 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "0b738e59-e37f-4e26-b63e-140b7338e7f0" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:54:40 | 200 |       505.1â”¬â•¡s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:54:40 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:54:40 | 200 |     48.8802ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:54:40 | 401 |     52.9288ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:54:40 | 200 |     96.6299ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:54:40 | 200 |     49.5249ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.30s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:54:40 | 200 |     61.5138ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | PUT      "/admin/users/1d887bd3-241b-4a58-9817-1ecb61febe05/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:54:40 | 200 |     53.6912ms |                 | POST     "/admin/users/1d887bd3-241b-4a58-9817-1ecb61febe05/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | DELETE   "/admin/users/1d887bd3-241b-4a58-9817-1ecb61febe05"

2026/01/14 07:54:40 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "1d887bd3-241b-4a58-9817-1ecb61febe05" AND `users`.`id` = "1d887bd3-241b-4a58-9817-1ecb61febe05" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.17s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:54:40 | 201 |       504.6â”¬â•¡s |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:54:40 | 201 |            0s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | GET      "/boards/96e86b3f-937a-4d90-a9f6-0f34ba49df10"

2026/01/14 07:54:40 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:229 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "877350a7-97af-48de-86d7-0413819efadb" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:54:40 | 404 |            0s |                 | GET      "/boards/877350a7-97af-48de-86d7-0413819efadb"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 07:54:40 | 200 |       514.2â”¬â•¡s |                 | PUT      "/boards/9d03b7b3-7614-46e1-873e-a8f2fb90c998/status"
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | PUT      "/boards/9d03b7b3-7614-46e1-873e-a8f2fb90c998/status"
--- PASS: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | PUT      "/boards/811e9fee-b7d2-4426-a441-ca0cf465e677"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board 38fe9248-90b5-467a-8781-86c8477f4806.
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | POST     "/boards/38fe9248-90b5-467a-8781-86c8477f4806/join"
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | POST     "/boards/38fe9248-90b5-467a-8781-86c8477f4806/leave"
[GIN] 2026/01/14 - 07:54:40 | 400 |            0s |                 | POST     "/boards/38fe9248-90b5-467a-8781-86c8477f4806/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | POST     "/boards/92ec03f6-4aca-4f22-bfaa-e1cfc42b3bc9/claim"
[GIN] 2026/01/14 - 07:54:40 | 200 |         508â”¬â•¡s |                 | POST     "/boards/92ec03f6-4aca-4f22-bfaa-e1cfc42b3bc9/claim"
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | POST     "/boards/92ec03f6-4aca-4f22-bfaa-e1cfc42b3bc9/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | DELETE   "/boards/43f2b86f-fcc2-48af-bcab-186ae42b09ba"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestColumnCRUD
[GIN] 2026/01/14 - 07:54:40 | 201 |            0s |                 | POST     "/boards/e7c401b6-d2f8-41d3-af7d-056b80730291/columns"
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | PUT      "/columns/e977f653-260f-4aa1-8f37-67804201f0b6"
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | PUT      "/columns/e977f653-260f-4aa1-8f37-67804201f0b6/position"
[GIN] 2026/01/14 - 07:54:40 | 201 |            0s |                 | POST     "/boards/e7c401b6-d2f8-41d3-af7d-056b80730291/columns"
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | DELETE   "/columns/e977f653-260f-4aa1-8f37-67804201f0b6"
--- PASS: TestColumnCRUD (0.00s)
=== RUN   TestCardCRUD
[GIN] 2026/01/14 - 07:54:40 | 201 |            0s |                 | POST     "/columns/5750360f-6ca2-4526-bcd7-46abd9753ddd/cards"
[GIN] 2026/01/14 - 07:54:40 | 200 |      1.1016ms |                 | PUT      "/cards/850560a4-b8e1-4b85-8a5e-e9679d72a824"
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | DELETE   "/cards/850560a4-b8e1-4b85-8a5e-e9679d72a824"
--- PASS: TestCardCRUD (0.00s)
=== RUN   TestMoveCard
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | PUT      "/cards/68c9041e-37e1-4b47-908f-2b66c03dd308/move"
--- PASS: TestMoveCard (0.00s)
=== RUN   TestMergeAndUnmergeCard
[GIN] 2026/01/14 - 07:54:40 | 200 |       511.3â”¬â•¡s |                 | POST     "/cards/2c63670b-4fe4-4886-8ebf-fa1055ac08a4/merge"
[GIN] 2026/01/14 - 07:54:40 | 200 |            0s |                 | POST     "/cards/2c63670b-4fe4-4886-8ebf-fa1055ac08a4/unmerge"
--- PASS: TestMergeAndUnmergeCard (0.00s)
=== RUN   TestSadPaths
[GIN] 2026/01/14 - 07:54:40 | 400 |            0s |       192.0.2.1 | PUT      "/columns/invalid-uuid"

2026/01/14 07:54:40 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/column_handler.go:75 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `columns` WHERE `columns`.`id` = "2a45711c-7222-4b90-8b38-d9869e5dd1de" AND `columns`.`deleted_at` IS NULL ORDER BY `columns`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:54:40 | 404 |            0s |       192.0.2.1 | PUT      "/columns/2a45711c-7222-4b90-8b38-d9869e5dd1de"

2026/01/14 07:54:40 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/card_handler.go:171 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `cards` WHERE `cards`.`id` = "64699b83-086c-4d9d-88ed-eb8cc0db07ab" AND `cards`.`deleted_at` IS NULL ORDER BY `cards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:54:40 | 404 |            0s |                 | POST     "/cards/8d79b858-383b-4ed4-8e40-6d6a29b56186/merge"
--- PASS: TestSadPaths (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:54:40 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.10s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.10s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:54:40 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
=== RUN   TestVoteFlow

2026/01/14 07:54:41 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "7e33d442-29de-48d5-aa3a-74a783e5e5dd" AND user_name = "user1" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:54:41 | 201 |       510.1â”¬â•¡s |                 | POST     "/cards/7e33d442-29de-48d5-aa3a-74a783e5e5dd/votes"
[GIN] 2026/01/14 - 07:54:41 | 400 |            0s |                 | POST     "/cards/7e33d442-29de-48d5-aa3a-74a783e5e5dd/votes"
[GIN] 2026/01/14 - 07:54:41 | 200 |            0s |                 | POST     "/cards/7e33d442-29de-48d5-aa3a-74a783e5e5dd/votes"

2026/01/14 07:54:41 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "7e33d442-29de-48d5-aa3a-74a783e5e5dd" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:54:41 | 201 |            0s |       192.0.2.1 | POST     "/cards/7e33d442-29de-48d5-aa3a-74a783e5e5dd/votes"

2026/01/14 07:54:41 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "ea12be02-17f0-4e0d-812c-bf809cef7743" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:54:41 | 403 |            0s |       192.0.2.1 | POST     "/cards/ea12be02-17f0-4e0d-812c-bf809cef7743/votes"
--- PASS: TestVoteFlow (0.00s)
=== RUN   TestGetVotesBlind
[GIN] 2026/01/14 - 07:54:41 | 200 |            0s |       192.0.2.1 | GET      "/cards/0c6f9312-2bb7-4679-84cd-f31c44bd0b66/votes?user=me"
[GIN] 2026/01/14 - 07:54:41 | 200 |            0s |       192.0.2.1 | GET      "/cards/0c6f9312-2bb7-4679-84cd-f31c44bd0b66/votes?user=me"
--- PASS: TestGetVotesBlind (0.00s)
=== RUN   TestReactionFlow

2026/01/14 07:54:41 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/reaction_handler.go:39 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `reactions` WHERE (card_id = "464c0b74-de6a-44b1-8b8c-80db8be49403" AND user_name = "user1" AND reaction_type = "love") AND `reactions`.`deleted_at` IS NULL ORDER BY `reactions`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:54:41 | 200 |            0s |                 | POST     "/cards/464c0b74-de6a-44b1-8b8c-80db8be49403/reactions"
[GIN] 2026/01/14 - 07:54:41 | 200 |            0s |       192.0.2.1 | POST     "/cards/464c0b74-de6a-44b1-8b8c-80db8be49403/reactions"
[GIN] 2026/01/14 - 07:54:41 | 400 |            0s |       192.0.2.1 | POST     "/cards/464c0b74-de6a-44b1-8b8c-80db8be49403/reactions"
--- PASS: TestReactionFlow (0.00s)
PASS
ok  	retro-app/internal/handlers	1.519s
