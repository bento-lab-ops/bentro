=== RUN   TestRegister
[GIN] 2026/01/14 - 07:58:53 | 201 |     53.4806ms |                 | POST     "/register"

2026/01/14 07:58:53 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("e5ec5cd1-3cb1-416c-a41e-7ea62a3f1e84","john@example.com","johndoe","$2a$10$7aq6JNTK53me5P2b4320rOtFOfG1IxXV.pMSBY37Cm/BVHb9RP5HW","John Doe","","user",false,"2026-01-14 07:58:53.645","2026-01-14 07:58:53.645","2026-01-14 07:58:53.645")
[GIN] 2026/01/14 - 07:58:53 | 409 |     46.9819ms |                 | POST     "/register"
--- PASS: TestRegister (0.10s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:58:53 | 200 |     48.2459ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:58:53 | 401 |     47.7386ms |                 | POST     "/login"
--- PASS: TestLogin (0.14s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:58:53 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:58:53 | 200 |     52.7537ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:58:53 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:58:53 | 200 |     52.9298ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:58:53 | 403 |            0s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:58:54 | 200 |     48.0677ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.15s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:58:54 | 200 |     46.5732ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "4cc476e8-878c-4369-98f1-ed9f53a46ad5" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:58:54 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:58:54 | 200 |       53.26ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:58:54 | 401 |      58.399ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:58:54 | 200 |     94.3858ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:58:54 | 200 |     50.1889ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.31s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:58:54 | 200 |     47.6098ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/admin/users/d563c01f-3021-46ba-aadb-65450b729e15/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:58:54 | 200 |      47.618ms |                 | POST     "/admin/users/d563c01f-3021-46ba-aadb-65450b729e15/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | DELETE   "/admin/users/d563c01f-3021-46ba-aadb-65450b729e15"

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "d563c01f-3021-46ba-aadb-65450b729e15" AND `users`.`id` = "d563c01f-3021-46ba-aadb-65450b729e15" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.14s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:58:54 | 201 |       504.6â”¬â•¡s |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:58:54 | 201 |       509.4â”¬â•¡s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | GET      "/boards/eef4fab0-87c2-4184-9f2e-e6f414bf6797"

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:229 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "8ce48cff-1e40-4e5e-8e5a-3c3f31efd5e6" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:58:54 | 404 |            0s |                 | GET      "/boards/8ce48cff-1e40-4e5e-8e5a-3c3f31efd5e6"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/boards/6e4a51e0-5e53-4db5-a9da-780e97b7923a/status"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/boards/6e4a51e0-5e53-4db5-a9da-780e97b7923a/status"
--- PASS: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/boards/7932ab7e-9809-40d4-b801-79d00a8326f4"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board 57b3634c-4fd0-4f31-b0ff-e4b8a75951e4.
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/boards/57b3634c-4fd0-4f31-b0ff-e4b8a75951e4/join"
[GIN] 2026/01/14 - 07:58:54 | 200 |       506.9â”¬â•¡s |                 | POST     "/boards/57b3634c-4fd0-4f31-b0ff-e4b8a75951e4/leave"
[GIN] 2026/01/14 - 07:58:54 | 400 |            0s |                 | POST     "/boards/57b3634c-4fd0-4f31-b0ff-e4b8a75951e4/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/boards/af1ae6b4-9fe2-4a3a-923e-7891f30b295d/claim"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/boards/af1ae6b4-9fe2-4a3a-923e-7891f30b295d/claim"
[GIN] 2026/01/14 - 07:58:54 | 200 |       513.3â”¬â•¡s |                 | POST     "/boards/af1ae6b4-9fe2-4a3a-923e-7891f30b295d/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | DELETE   "/boards/b669dfd5-950d-4237-bb74-d62186769730"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestColumnCRUD
[GIN] 2026/01/14 - 07:58:54 | 201 |            0s |                 | POST     "/boards/08bcac09-82da-4b8d-8954-12abb58a9fa3/columns"
[GIN] 2026/01/14 - 07:58:54 | 200 |       508.1â”¬â•¡s |                 | PUT      "/columns/8356977d-0e32-43de-b1ba-c401a3f0953b"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/columns/8356977d-0e32-43de-b1ba-c401a3f0953b/position"
[GIN] 2026/01/14 - 07:58:54 | 201 |            0s |                 | POST     "/boards/08bcac09-82da-4b8d-8954-12abb58a9fa3/columns"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | DELETE   "/columns/8356977d-0e32-43de-b1ba-c401a3f0953b"
--- PASS: TestColumnCRUD (0.00s)
=== RUN   TestCardCRUD
[GIN] 2026/01/14 - 07:58:54 | 201 |            0s |                 | POST     "/columns/dae24053-9545-4cdf-9746-f0531af42c27/cards"
[GIN] 2026/01/14 - 07:58:54 | 200 |       511.5â”¬â•¡s |                 | PUT      "/cards/04aea0e5-4a3a-45bf-a53e-458e7a81b8fa"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | DELETE   "/cards/04aea0e5-4a3a-45bf-a53e-458e7a81b8fa"
--- PASS: TestCardCRUD (0.00s)
=== RUN   TestMoveCard
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/cards/e21c934f-9186-4b27-91c3-0a46886ede49/move"
--- PASS: TestMoveCard (0.00s)
=== RUN   TestMergeAndUnmergeCard
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/cards/0fc4fb97-d97f-4be1-a2db-72355a2b1149/merge"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/cards/0fc4fb97-d97f-4be1-a2db-72355a2b1149/unmerge"
--- PASS: TestMergeAndUnmergeCard (0.00s)
=== RUN   TestSadPaths
[GIN] 2026/01/14 - 07:58:54 | 400 |            0s |       192.0.2.1 | PUT      "/columns/invalid-uuid"

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/column_handler.go:75 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `columns` WHERE `columns`.`id` = "2b1b1239-9446-48f5-a2cf-346edf5ec734" AND `columns`.`deleted_at` IS NULL ORDER BY `columns`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:58:54 | 404 |            0s |       192.0.2.1 | PUT      "/columns/2b1b1239-9446-48f5-a2cf-346edf5ec734"

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/card_handler.go:171 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `cards` WHERE `cards`.`id` = "d2bfd622-8bb1-4ba9-9cda-65c9254921e2" AND `cards`.`deleted_at` IS NULL ORDER BY `cards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:58:54 | 404 |            0s |                 | POST     "/cards/fc233e1c-5e01-4ad3-b145-82985a0e31d6/merge"
--- PASS: TestSadPaths (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.10s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.09s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
=== RUN   TestTeamCRUD
[GIN] 2026/01/14 - 07:58:54 | 201 |            0s |                 | POST     "/teams"
[GIN] 2026/01/14 - 07:58:54 | 200 |       559.7â”¬â•¡s |                 | PUT      "/teams/d01e2a1a-b580-49b8-8cd2-d8df5cd726ea"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | DELETE   "/teams/d01e2a1a-b580-49b8-8cd2-d8df5cd726ea"
    team_handler_test.go:129: 
        	Error Trace:	C:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/team_handler_test.go:129
        	Error:      	Not equal: 
        	            	expected: 1
        	            	actual  : 0
        	Test:       	TestTeamCRUD
--- FAIL: TestTeamCRUD (0.00s)
=== RUN   TestTeamMembership
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/teams/98df17c8-2cf0-4832-b62d-ec048edd3d01/join"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/teams/98df17c8-2cf0-4832-b62d-ec048edd3d01/leave"
[GIN] 2026/01/14 - 07:58:54 | 403 |            0s |                 | POST     "/teams/98df17c8-2cf0-4832-b62d-ec048edd3d01/join"
[GIN] 2026/01/14 - 07:58:54 | 201 |            0s |                 | POST     "/teams/98df17c8-2cf0-4832-b62d-ec048edd3d01/members"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | DELETE   "/teams/98df17c8-2cf0-4832-b62d-ec048edd3d01/members/59b0fe7f-3026-41ff-836c-e96771490c28"
--- PASS: TestTeamMembership (0.00s)
=== RUN   TestTeamRoles
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/teams/9d6dfbc9-a703-42a1-9042-e8dc24af67f0/members/60f0532f-e988-426d-aa53-9347e0e3fa78/role"
--- PASS: TestTeamRoles (0.00s)
=== RUN   TestListTeams
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | GET      "/teams/mine"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |       192.0.2.1 | GET      "/teams"
--- PASS: TestListTeams (0.00s)
=== RUN   TestSearchUsers
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=Alic"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=bob@"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=a"
--- PASS: TestSearchUsers (0.00s)
=== RUN   TestAdminLogin
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/admin/login"
[GIN] 2026/01/14 - 07:58:54 | 401 |       507.1â”¬â•¡s |                 | POST     "/admin/login"
--- PASS: TestAdminLogin (0.00s)
=== RUN   TestAdminUpdateBoardSettings
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | PUT      "/admin/boards/0300f238-f837-48e0-9b8a-61b536ca96f6/settings"
--- PASS: TestAdminUpdateBoardSettings (0.00s)
=== RUN   TestGetSystemStats
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |       192.0.2.1 | GET      "/admin/stats"
--- PASS: TestGetSystemStats (0.00s)
=== RUN   TestVoteFlow

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "ced455a8-00f6-41c1-a978-4e05574df660" AND user_name = "user1" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:58:54 | 201 |       504.3â”¬â•¡s |                 | POST     "/cards/ced455a8-00f6-41c1-a978-4e05574df660/votes"
[GIN] 2026/01/14 - 07:58:54 | 400 |            0s |                 | POST     "/cards/ced455a8-00f6-41c1-a978-4e05574df660/votes"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/cards/ced455a8-00f6-41c1-a978-4e05574df660/votes"

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "ced455a8-00f6-41c1-a978-4e05574df660" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:58:54 | 201 |            0s |       192.0.2.1 | POST     "/cards/ced455a8-00f6-41c1-a978-4e05574df660/votes"

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "9a791855-f7d8-48e2-94d8-4dc153b70a00" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:58:54 | 403 |            0s |       192.0.2.1 | POST     "/cards/9a791855-f7d8-48e2-94d8-4dc153b70a00/votes"
--- PASS: TestVoteFlow (0.00s)
=== RUN   TestGetVotesBlind
[GIN] 2026/01/14 - 07:58:54 | 200 |       504.2â”¬â•¡s |       192.0.2.1 | GET      "/cards/d7864a09-02ac-4e8e-bf94-ef573404567f/votes?user=me"
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |       192.0.2.1 | GET      "/cards/d7864a09-02ac-4e8e-bf94-ef573404567f/votes?user=me"
--- PASS: TestGetVotesBlind (0.00s)
=== RUN   TestReactionFlow

2026/01/14 07:58:54 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/reaction_handler.go:39 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `reactions` WHERE (card_id = "c19e69e1-3beb-4f6d-ab24-71263adaf701" AND user_name = "user1" AND reaction_type = "love") AND `reactions`.`deleted_at` IS NULL ORDER BY `reactions`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:58:54 | 200 |            0s |                 | POST     "/cards/c19e69e1-3beb-4f6d-ab24-71263adaf701/reactions"
[GIN] 2026/01/14 - 07:58:54 | 200 |       507.8â”¬â•¡s |       192.0.2.1 | POST     "/cards/c19e69e1-3beb-4f6d-ab24-71263adaf701/reactions"
[GIN] 2026/01/14 - 07:58:54 | 400 |            0s |       192.0.2.1 | POST     "/cards/c19e69e1-3beb-4f6d-ab24-71263adaf701/reactions"
--- PASS: TestReactionFlow (0.00s)
FAIL
FAIL	retro-app/internal/handlers	1.521s
FAIL
