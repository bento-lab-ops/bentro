=== RUN   TestRegister
[GIN] 2026/01/14 - 08:00:11 | 201 |     49.5515ms |                 | POST     "/register"

2026/01/14 08:00:11 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("40256630-447f-4b00-9468-a8e722f3e02b","john@example.com","johndoe","$2a$10$OJZzWrFsMPS1AMekTd8.gexnoTn75.OexLMbi3L/iOggOMej1BV6C","John Doe","","user",false,"2026-01-14 08:00:11.557","2026-01-14 08:00:11.558","2026-01-14 08:00:11.558")
[GIN] 2026/01/14 - 08:00:11 | 409 |     47.6596ms |                 | POST     "/register"
--- PASS: TestRegister (0.10s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 08:00:11 | 200 |     46.9739ms |                 | POST     "/login"
[GIN] 2026/01/14 - 08:00:11 | 401 |     55.3657ms |                 | POST     "/login"
--- PASS: TestLogin (0.15s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 08:00:11 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 08:00:11 | 200 |     48.2792ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 08:00:11 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 08:00:11 | 200 |     52.4929ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 08:00:11 | 403 |            0s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 08:00:11 | 200 |     56.2468ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 08:00:11 | 200 |            0s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.16s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 08:00:12 | 200 |     48.8647ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "3a3865a3-3140-42eb-a559-c3dd39efb738" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:00:12 | 200 |       766.9â”¬â•¡s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 08:00:12 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.11s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 08:00:12 | 200 |     53.0441ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 08:00:12 | 401 |     48.9483ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 08:00:12 | 200 |     96.6928ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 08:00:12 | 200 |     47.0361ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.30s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 08:00:12 | 200 |      49.685ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/admin/users/d53c0f70-aaed-4054-8e06-85cabe6ba876/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 08:00:12 | 200 |     48.0232ms |                 | POST     "/admin/users/d53c0f70-aaed-4054-8e06-85cabe6ba876/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | DELETE   "/admin/users/d53c0f70-aaed-4054-8e06-85cabe6ba876"

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "d53c0f70-aaed-4054-8e06-85cabe6ba876" AND `users`.`id` = "d53c0f70-aaed-4054-8e06-85cabe6ba876" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.15s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 08:00:12 | 201 |            0s |                 | POST     "/boards"
[GIN] 2026/01/14 - 08:00:12 | 201 |         504â”¬â•¡s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 08:00:12 | 200 |      1.0052ms |                 | GET      "/boards/a1a9ab84-a7f0-4db2-844a-be88337a4612"

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:229 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "b77b14e5-3bdc-400b-b865-c95d003782c5" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:00:12 | 404 |            0s |                 | GET      "/boards/b77b14e5-3bdc-400b-b865-c95d003782c5"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/boards/a804be92-a864-4a83-9303-bec79cf916dc/status"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/boards/a804be92-a864-4a83-9303-bec79cf916dc/status"
--- PASS: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/boards/16887a0d-d446-4b05-bb41-bf78b36f1d7c"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board 2b52f987-8e37-44fb-ace5-77b72c79e231.
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/boards/2b52f987-8e37-44fb-ace5-77b72c79e231/join"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/boards/2b52f987-8e37-44fb-ace5-77b72c79e231/leave"
[GIN] 2026/01/14 - 08:00:12 | 400 |            0s |                 | POST     "/boards/2b52f987-8e37-44fb-ace5-77b72c79e231/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/boards/01deac6b-b1b9-434c-b9fb-356ebbd27512/claim"
[GIN] 2026/01/14 - 08:00:12 | 200 |       509.3â”¬â•¡s |                 | POST     "/boards/01deac6b-b1b9-434c-b9fb-356ebbd27512/claim"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/boards/01deac6b-b1b9-434c-b9fb-356ebbd27512/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | DELETE   "/boards/acc73956-0476-474a-9c3b-859b9cb4e68d"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestColumnCRUD
[GIN] 2026/01/14 - 08:00:12 | 201 |            0s |                 | POST     "/boards/0db8b93f-129c-47d5-8747-c8493d7212be/columns"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/columns/d025149d-dbb8-4010-8fab-af4d1db537bb"
[GIN] 2026/01/14 - 08:00:12 | 200 |       512.7â”¬â•¡s |                 | PUT      "/columns/d025149d-dbb8-4010-8fab-af4d1db537bb/position"
[GIN] 2026/01/14 - 08:00:12 | 201 |            0s |                 | POST     "/boards/0db8b93f-129c-47d5-8747-c8493d7212be/columns"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | DELETE   "/columns/d025149d-dbb8-4010-8fab-af4d1db537bb"
--- PASS: TestColumnCRUD (0.00s)
=== RUN   TestCardCRUD
[GIN] 2026/01/14 - 08:00:12 | 201 |            0s |                 | POST     "/columns/97b4aaca-a04c-4b37-b226-e475d2f6f555/cards"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/cards/4f244e0d-c491-4849-8c7c-a12ebd945415"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | DELETE   "/cards/4f244e0d-c491-4849-8c7c-a12ebd945415"
--- PASS: TestCardCRUD (0.00s)
=== RUN   TestMoveCard
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/cards/cbcdf953-002f-40d5-8c82-36545264465e/move"
--- PASS: TestMoveCard (0.00s)
=== RUN   TestMergeAndUnmergeCard
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/cards/de6887e7-a667-480b-976b-dc0120bb876c/merge"
[GIN] 2026/01/14 - 08:00:12 | 200 |      1.0144ms |                 | POST     "/cards/de6887e7-a667-480b-976b-dc0120bb876c/unmerge"
--- PASS: TestMergeAndUnmergeCard (0.00s)
=== RUN   TestSadPaths
[GIN] 2026/01/14 - 08:00:12 | 400 |            0s |       192.0.2.1 | PUT      "/columns/invalid-uuid"

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/column_handler.go:75 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `columns` WHERE `columns`.`id` = "7c6a3edc-0d1e-4bc5-8e10-cbe3fd2bc9a9" AND `columns`.`deleted_at` IS NULL ORDER BY `columns`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:00:12 | 404 |            0s |       192.0.2.1 | PUT      "/columns/7c6a3edc-0d1e-4bc5-8e10-cbe3fd2bc9a9"

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/card_handler.go:171 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `cards` WHERE `cards`.`id` = "489d90c8-2952-4431-bc99-9ce12a673b89" AND `cards`.`deleted_at` IS NULL ORDER BY `cards`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:00:12 | 404 |            0s |                 | POST     "/cards/f9ba5835-0f10-46f1-b590-9a51b8a9f749/merge"
--- PASS: TestSadPaths (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.09s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.10s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
=== RUN   TestTeamCRUD
[GIN] 2026/01/14 - 08:00:12 | 201 |            0s |                 | POST     "/teams"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/teams/641e3354-8e9e-4c99-99c8-c1938331e040"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | DELETE   "/teams/641e3354-8e9e-4c99-99c8-c1938331e040"
--- PASS: TestTeamCRUD (0.00s)
=== RUN   TestTeamMembership
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/teams/65770c08-608d-4976-a38f-85bc24f5c5f2/join"
[GIN] 2026/01/14 - 08:00:12 | 200 |       649.4â”¬â•¡s |                 | POST     "/teams/65770c08-608d-4976-a38f-85bc24f5c5f2/leave"
[GIN] 2026/01/14 - 08:00:12 | 403 |            0s |                 | POST     "/teams/65770c08-608d-4976-a38f-85bc24f5c5f2/join"
[GIN] 2026/01/14 - 08:00:12 | 201 |            0s |                 | POST     "/teams/65770c08-608d-4976-a38f-85bc24f5c5f2/members"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | DELETE   "/teams/65770c08-608d-4976-a38f-85bc24f5c5f2/members/a494c7ee-8e95-46db-8936-8316c522121c"
--- PASS: TestTeamMembership (0.00s)
=== RUN   TestTeamRoles
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | PUT      "/teams/b6640246-ec61-4f10-9f80-9a59220725ec/members/8d3610ae-a973-44ae-9a15-f3a1dd30a345/role"
--- PASS: TestTeamRoles (0.00s)
=== RUN   TestListTeams
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | GET      "/teams/mine"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |       192.0.2.1 | GET      "/teams"
--- PASS: TestListTeams (0.00s)
=== RUN   TestSearchUsers
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=Alic"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=bob@"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |       192.0.2.1 | GET      "/users/search?q=a"
--- PASS: TestSearchUsers (0.00s)
=== RUN   TestAdminLogin
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/admin/login"
[GIN] 2026/01/14 - 08:00:12 | 401 |            0s |                 | POST     "/admin/login"
--- PASS: TestAdminLogin (0.00s)
=== RUN   TestAdminUpdateBoardSettings
[GIN] 2026/01/14 - 08:00:12 | 200 |       511.3â”¬â•¡s |                 | PUT      "/admin/boards/5e215452-0c12-409a-a0b0-b21870b62241/settings"
--- PASS: TestAdminUpdateBoardSettings (0.00s)
=== RUN   TestGetSystemStats
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |       192.0.2.1 | GET      "/admin/stats"
--- PASS: TestGetSystemStats (0.00s)
=== RUN   TestVoteFlow

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "fa3365b0-45bb-4a1d-9fe1-a0c0dbddcc6e" AND user_name = "user1" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:00:12 | 201 |            0s |                 | POST     "/cards/fa3365b0-45bb-4a1d-9fe1-a0c0dbddcc6e/votes"
[GIN] 2026/01/14 - 08:00:12 | 400 |            0s |                 | POST     "/cards/fa3365b0-45bb-4a1d-9fe1-a0c0dbddcc6e/votes"
[GIN] 2026/01/14 - 08:00:12 | 200 |       695.4â”¬â•¡s |                 | POST     "/cards/fa3365b0-45bb-4a1d-9fe1-a0c0dbddcc6e/votes"

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "fa3365b0-45bb-4a1d-9fe1-a0c0dbddcc6e" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:00:12 | 201 |            0s |       192.0.2.1 | POST     "/cards/fa3365b0-45bb-4a1d-9fe1-a0c0dbddcc6e/votes"

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/vote_handler.go:45 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `votes` WHERE card_id = "99ba8d11-c3d0-4742-a2d2-cc51f675fdf8" AND user_name = "user2" ORDER BY `votes`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:00:12 | 403 |            0s |       192.0.2.1 | POST     "/cards/99ba8d11-c3d0-4742-a2d2-cc51f675fdf8/votes"
--- PASS: TestVoteFlow (0.00s)
=== RUN   TestGetVotesBlind
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |       192.0.2.1 | GET      "/cards/ff2e8c6d-cf57-43d7-b2c1-8942e23d27aa/votes?user=me"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |       192.0.2.1 | GET      "/cards/ff2e8c6d-cf57-43d7-b2c1-8942e23d27aa/votes?user=me"
--- PASS: TestGetVotesBlind (0.00s)
=== RUN   TestReactionFlow

2026/01/14 08:00:12 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/reaction_handler.go:39 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `reactions` WHERE (card_id = "cee8defc-163c-4e85-a861-fb3db09e1c18" AND user_name = "user1" AND reaction_type = "love") AND `reactions`.`deleted_at` IS NULL ORDER BY `reactions`.`id` LIMIT 1
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |                 | POST     "/cards/cee8defc-163c-4e85-a861-fb3db09e1c18/reactions"
[GIN] 2026/01/14 - 08:00:12 | 200 |            0s |       192.0.2.1 | POST     "/cards/cee8defc-163c-4e85-a861-fb3db09e1c18/reactions"
[GIN] 2026/01/14 - 08:00:12 | 400 |            0s |       192.0.2.1 | POST     "/cards/cee8defc-163c-4e85-a861-fb3db09e1c18/reactions"
--- PASS: TestReactionFlow (0.00s)
PASS
ok  	retro-app/internal/handlers	1.526s
