<!-- Modal for Login -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeLoginModal()">&times;</span>
        <h2 data-i18n="modal.login_title">Login</h2>
        <form id="loginForm" onsubmit="handleLoginSubmit(event)">
            <div class="form-group">
                <label for="loginEmail" data-i18n="label.email">Email</label>
                <input type="email" id="loginEmail" class="form-input" required>
            </div>
            <div class="form-group">
                <label for="loginPassword" data-i18n="label.password">Password</label>
                <input type="password" id="loginPassword" class="form-input" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;" data-i18n="btn.login">Login</button>
        </form>
        <div style="margin-top: 1rem; text-align: center;">
            <small><a href="#" onclick="switchToRegister()" data-i18n="msg.no_account">No account? Register</a></small>
        </div>
    </div>
</div>

<!-- Modal for Register -->
<div id="registerModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeRegisterModal()">&times;</span>
        <h2 data-i18n="modal.register_title">Register</h2>
        <form id="registerForm" onsubmit="handleRegisterSubmit(event)">
            <div class="form-row" style="display: flex; gap: 10px;">
                <div class="form-group" style="flex: 1;">
                    <label for="registerFirstName" data-i18n="label.first_name">First Name</label>
                    <input type="text" id="registerFirstName" class="form-input" required>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="registerLastName" data-i18n="label.last_name">Last Name</label>
                    <input type="text" id="registerLastName" class="form-input" required>
                </div>
            </div>
            <div class="form-group">
                <label for="registerDisplayName" data-i18n="label.display_name">Display Name (Nickname)</label>
                <input type="text" id="registerDisplayName" class="form-input" required minlength="3">
            </div>
            <div class="form-group">
                <label for="registerEmail" data-i18n="label.email">Email</label>
                <input type="email" id="registerEmail" class="form-input" required>
            </div>
            <div class="form-group">
                <label for="registerPassword" data-i18n="label.password">Password</label>
                <input type="password" id="registerPassword" class="form-input" required minlength="6">
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;"
                data-i18n="btn.register">Register</button>
        </form>
        <div style="margin-top: 1rem; text-align: center;">
            <small><a href="#" onclick="switchToLogin()" data-i18n="msg.have_account">Have an account? Login</a></small>
        </div>
    </div>
</div>

<!-- Modal for User Profile -->
<div id="userProfileModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeUserProfileModal()">&times;</span>
        <h2 data-i18n="modal.user_profile">User Profile</h2>
        <div class="form-group">
            <label data-i18n="label.display_name">Display Name</label>
            <input type="text" id="profileDisplayName" class="form-input" readonly>
        </div>
        <div class="form-group">
            <label data-i18n="label.name">Full Name</label>
            <input type="text" id="profileFullName" class="form-input" readonly>
        </div>
        <div class="form-group">
            <label data-i18n="label.email">Email</label>
            <input type="email" id="profileEmail" class="form-input" readonly
                style="background-color: var(--bg-secondary); cursor: not-allowed;">
            <small style="color: var(--text-secondary);" data-i18n="msg.email_readonly">Email cannot be changed</small>
        </div>
        <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
            <button class="btn btn-primary" onclick="openChangePasswordModal(); closeUserProfileModal()"
                data-i18n="btn.change_password">Change Password</button>
            <button class="btn btn-outline" onclick="handleUserLogout(); closeUserProfileModal()"
                data-i18n="menu.logout">Logout</button>
        </div>
    </div>
</div>

<!-- Modal for Change Password -->
<div id="changePasswordModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeChangePasswordModal()">&times;</span>
        <h2 data-i18n="modal.change_password">Change Password</h2>
        <div id="passwordChangeRequired" style="display: none; margin-bottom: 1rem;">
            <div class="alert alert-warning" data-i18n="msg.must_change_password">
                You must change your password before continuing.
            </div>
        </div>
        <form id="changePasswordForm" onsubmit="handleChangePasswordSubmit(event)">
            <div class="form-group">
                <label for="currentPassword" data-i18n="label.old_password">Current Password</label>
                <input type="password" id="currentPassword" class="form-input" required>
            </div>
            <div class="form-group">
                <label for="newPassword" data-i18n="label.new_password">New Password</label>
                <input type="password" id="newPassword" class="form-input" required minlength="6">
            </div>
            <div class="form-group">
                <label for="confirmPassword" data-i18n="label.confirm_password">Confirm New Password</label>
                <input type="password" id="confirmPassword" class="form-input" required minlength="6">
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;" data-i18n="btn.change_password">Change
                Password</button>
        </form>
    </div>
</div>

<!-- Modal for Returning User Confirmation -->
<div id="returningUserModal" class="modal">
    <div class="modal-content">
        <h2 data-i18n="modal.welcome_back">Welcome Back! üëã</h2>
        <p><span data-i18n="modal.continue_as">Continue as</span> <strong id="returningUserName"></strong>?</p>
        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button id="continueAsUserBtn" class="btn btn-primary" style="flex: 1;"
                data-i18n="modal.confirm">Continue</button>
            <button id="changeUserBtn" class="btn btn-outline" style="flex: 1;" data-i18n="modal.change_name">Change
                Name</button>
        </div>
    </div>
</div>

<!-- Modal for User Identity -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <h2 data-i18n="modal.welcome">Welcome!</h2>
        <p data-i18n="modal.enter_name">Please login to continue.</p>

        <div class="auth-buttons" style="display: flex; flex-direction: column; gap: 1rem;">
            <button class="btn btn-primary" onclick="openLoginModal()" data-i18n="btn.login">Login</button>
            <button class="btn btn-outline" onclick="openRegisterModal()" data-i18n="btn.register">Create
                Account</button>
        </div>

        <div style="margin-top: 2rem; border-top: 1px solid var(--border); padding-top: 1rem;">
            <p style="text-align: center; font-size: 0.9rem; margin-bottom: 0.5rem;" data-i18n="msg.guest_option">Or
                continue as guest (Data not saved)</p>
            <button class="btn btn-secondary btn-sm" onclick="toggleGuestForm()" style="width: 100%;"
                data-i18n="btn.guest_login">Continue as Guest</button>
        </div>

        <form id="userForm" style="display: none; margin-top: 1rem;">
            <!-- Avatar Selection -->
            <div class="form-group">
                <label data-i18n="label.choose_avatar">Choose Your Avatar</label>
                <div id="avatarSelector" class="avatar-selector">
                    <!-- Populated by JavaScript -->
                </div>
                <input type="hidden" id="selectedAvatar" value="üòÄ">
            </div>

            <div class="form-group">
                <label for="userNameInput" data-i18n="label.your_name">Your Name</label>
                <input type="text" id="userNameInput" class="form-input" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;" data-i18n="btn.join_retro">Join
                Retrospective</button>
        </form>
    </div>
</div>

<!-- Modal for Help/About -->
<div id="helpModal" class="modal">
    <div class="modal-content help-modal-content">
        <span class="close">&times;</span>
        <h2><span data-i18n="help.title">About BenTro</span> <img src="/static/bentrologo.png" alt="BenTro Logo"
                style="height: 32px; vertical-align: bottom;"></h2>
        <div class="help-content">
            <p><strong>BenTro</strong> = <em>Bento</em> + <em>Retrospective</em></p>
            <p class="tagline-help" data-i18n="help.tagline">Retrospectives, packed perfectly!</p>
            <p data-i18n="help.desc_full">A friendly retrospective tool created to make team collaboration effortless!
            </p>
            <hr>
            <h3 data-i18n="help.quick_start">Quick Start</h3>
            <ul>
                <li>Create a board with custom columns</li>
                <li>Add cards during Input Phase</li>
                <li>Switch to Voting Phase to vote on cards</li>
                <li>Click "Select" on a card, then "Merge Here" on another to combine similar ideas</li>
                <li>Export your retrospective data as CSV</li>
            </ul>
            <hr>
            <h3 data-i18n="help.shortcuts">Keyboard Shortcuts</h3>
            <ul class="shortcuts-list">
                <li><kbd>?</kbd> Toggle Help</li>
                <li><kbd>Esc</kbd> Close Modals</li>
                <li><kbd>Shift</kbd> + <kbd>E</kbd> Export CSV</li>
                <li><kbd>Shift</kbd> + <kbd>T</kbd> Toggle Timer</li>
                <li><kbd>Shift</kbd> + <kbd>V</kbd> Switch Phase</li>
                <li><kbd>Shift</kbd> + <kbd>N</kbd> New Card</li>
            </ul>
            <hr>
            <p><a href="https://github.com/bento-lab-ops/bentro" id="githubLink" target="_blank"
                    data-i18n="help.view_docs">View Documentation on
                    GitHub</a></p>
            <hr>
            <p><small>Version: <span id="appVersion"></span></small></p>
        </div>
    </div>
</div>

<!-- Modal for New Board -->
<div id="newBoardModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 data-i18n="heading.create_new_board">Create New Board</h2>
        <form id="newBoardForm">
            <div class="form-group">
                <label for="boardName" data-i18n="label.board_name">Board Name</label>
                <input type="text" id="boardName" class="form-input" placeholder="Sprint 42 Retrospective"
                    data-i18n="placeholder.board_name" data-i18n-target="placeholder" required>
            </div>
            <div class="form-group">
                <label for="boardTemplate" data-i18n="label.template">Template</label>
                <select id="boardTemplate" class="form-input">
                    <option value="custom" data-i18n="template.custom">Custom (Manual Entry)</option>
                    <!-- Templates loaded dynamically from board-templates.json -->
                </select>
                <small data-i18n="small.template_help">Choose a template or enter custom columns below</small>
            </div>
            <div class="form-group">
                <label data-i18n="label.column_names">Column Names (one per line)</label>
                <textarea id="columnNames" class="form-textarea" rows="4"
                    placeholder="Select a template above or enter custom columns"></textarea>
                <small data-i18n="small.columns_help">Leave empty for default columns</small>
            </div>
            <button type="submit" class="btn btn-primary" data-i18n="btn.create_board">Create Board</button>
        </form>
    </div>
</div>

<!-- Modal for New Card -->
<div id="newCardModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add New Card</h2>
        <form id="newCardForm">
            <div class="form-group">
                <label for="cardContent" data-i18n="label.card_content">Card Content</label>
                <textarea id="cardContent" class="form-textarea" rows="3" placeholder="Enter your thoughts..."
                    data-i18n="placeholder.card_content" data-i18n-target="placeholder" required></textarea>
            </div>
            <input type="hidden" id="cardColumnId">
            <button type="submit" class="btn btn-primary" data-i18n="btn.add_card">Add Card</button>
        </form>
    </div>
</div>

<!-- Modal for Edit Column -->
<div id="editColumnModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 data-i18n="heading.edit_column">Edit Column Name</h2>
        <form id="editColumnForm">
            <div class="form-group">
                <label for="columnNameEdit" data-i18n="label.column_name">Column Name</label>
                <input type="text" id="columnNameEdit" class="form-input" required>
            </div>
            <input type="hidden" id="editColumnId">
            <button type="submit" class="btn btn-primary" data-i18n="btn.update_column">Update Column</button>
        </form>
    </div>
</div>

<!-- Modal for Unmerge Cards -->
<div id="unmergeModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Merged Cards</h2>
        <div id="mergedCardsList" class="merged-cards-list">
            <!-- Merged cards will be listed here -->
        </div>
    </div>
</div>

<!-- Modal for Action Item Details -->
<div id="actionItemModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="modal-header">
            <h2 data-i18n="heading.action_details">‚ö° Action Item Details</h2>
        </div>
        <div class="form-group">
            <label for="actionItemOwner" data-i18n="action.owner">Owner</label>
            <div class="action-owner-input-wrapper">
                <select id="actionItemOwner" class="form-input">
                    <option value="" data-i18n="action.unassigned">Unassigned</option>
                    <!-- Populated dynamically -->
                </select>
            </div>
        </div>
        <div class="form-group">
            <label for="actionItemDueDate" data-i18n="action.due_date">Due Date</label>
            <input type="date" id="actionItemDueDate" class="form-input">
        </div>
        <input type="hidden" id="actionItemCardId">
        <div class="modal-actions" style="display: flex; justify-content: space-between; gap: 1rem;">
            <button class="btn btn-danger btn-outline" onclick="removeActionItem()"
                data-i18n="btn.remove_action_item">Remove Action Item</button>
            <button class="btn btn-primary" onclick="saveActionItem()" data-i18n="btn.save_details">Save
                Details</button>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div id="boardSettingsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeBoardSettingsModal()">&times;</span>
        <h2>Board Settings</h2>
        <div class="form-group">
            <label for="settingVoteLimit">Vote Limit per User (0 = unlimited)</label>
            <input type="number" id="settingVoteLimit" class="form-input" min="0">
        </div>
        <div class="form-group">
            <label for="settingBlindVoting" style="display:flex; align-items:center; gap:0.5rem;">
                <input type="checkbox" id="settingBlindVoting">
                Enable Blind Voting (Hide counts during voting)
            </label>
        </div>
        <button class="btn btn-primary" onclick="saveBoardSettings()">Save Settings</button>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content settings-modal-content">
        <span class="close" onclick="closeSettingsModal()">&times;</span>
        <h2>Settings</h2>
        <div id="settingsContent">
            <!-- Content will be rendered by JS -->
        </div>
    </div>
</div>

<!-- Complete Action Item Modal -->
<div id="completeActionItemModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeCompleteActionItemModal()">&times;</span>
        <h2 data-i18n="heading.complete_action">‚úÖ Complete Action Item</h2>
        <p data-i18n="text.resolution_details">Add details about the resolution.</p>
        <form id="completeActionItemForm" onsubmit="submitActionItemCompletion(event)">
            <input type="hidden" id="completeActionItemId">

            <div class="form-group">
                <label data-i18n="label.completion_date">Completion Date</label>
                <input type="date" id="completeActionItemDate" class="form-input" required>
            </div>

            <div class="form-group">
                <label data-i18n="label.link_optional">Link / PR (Optional)</label>
                <input type="url" id="completeActionItemLink" class="form-input" placeholder="https://github.com/...">
            </div>

            <div class="form-group">
                <label data-i18n="label.desc_optional">Description / Notes (Optional)</label>
                <textarea id="completeActionItemDesc" class="form-textarea" placeholder="What was done..."
                    data-i18n="placeholder.what_done" data-i18n-target="placeholder"></textarea>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeCompleteActionItemModal()"
                    data-i18n="modal.cancel">Cancel</button>
                <button type="submit" class="btn btn-success" data-i18n="btn.complete_item">Complete Item</button>
            </div>
        </form>
    </div>
</div>

<!-- Read-Only Details Modal -->
<div id="actionItemDetailsModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeActionItemDetailsModal()">&times;</span>
        <h2>‚ÑπÔ∏è Action Item Details</h2>

        <div class="form-group">
            <label>Link</label>
            <div id="detailsLinkContainer" style="padding: 0.75rem; background: var(--bg-light); border-radius: 8px;">
                <a id="detailsLink" href="#" target="_blank" style="color: var(--accent-color);">No Link</a>
            </div>
        </div>

        <div class="form-group">
            <label data-i18n="label.desc_notes">Description / Notes</label>
            <div id="detailsDesc"
                style="padding: 0.75rem; background: var(--bg-light); border-radius: 8px; white-space: pre-wrap; min-height: 50px;">
                No description provided.
            </div>
        </div>

        <div class="modal-actions" style="justify-content: flex-end;">
            <button type="button" class="btn btn-primary" onclick="closeActionItemDetailsModal()">Close</button>
        </div>
    </div>
</div>