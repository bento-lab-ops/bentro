<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BenTro - Retrospectives, packed perfectly!</title>
    <link rel="icon" href="/static/bentrologo.png">
    <link rel="stylesheet" href="/static/bentro.css?v=v0.14.5">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>

<body>
    <div class="container mobile-container-fix">
        <header class="header">
            <div class="header-left">
                <div class="brand-logo-title" onclick="showDashboard()" style="cursor: pointer;">
                    <img src="/static/bentrologo.png" alt="BenTro Logo" class="header-logo">
                    <h1 class="title" data-i18n="app.title">BenTro</h1>
                </div>

            </div>

            <div class="header-right">
                <div id="headerControls" class="header-controls"
                    style="display: flex; gap: 1.5rem; align-items: center;">
                    <button id="newBoardBtn" class="btn btn-glass btn-small" data-i18n="btn.new_board"
                        style="display: none;">+ New Board</button>
                    <button id="dashboardBtn" class="btn btn-glass btn-small" onclick="showDashboard()"
                        style="display: none;" title="Dashboard">üè†</button>
                </div>
                <div class="lang-selector-container">
                    <button class="btn btn-glass btn-small" onclick="toggleLangMenu()" title="Select Language"
                        style="min-width: 42px; justify-content: center;">üåê</button>
                    <div id="langMenu" class="lang-dropdown">
                        <button onclick="i18n.setLanguage('en')">English (US) üá∫üá∏</button>
                        <button onclick="i18n.setLanguage('pt-BR')">Portugu√™s (BR) üáßüá∑</button>
                    </div>
                </div>
                <!-- Avatar Only -->
                <span id="userDisplay" class="user-display" onclick="openUserProfileModal()"></span>
                <button id="hamburgerBtn" class="hamburger-btn" title="Menu">‚ò∞</button>
            </div>
        </header>

        <!-- Dashboard View -->
        <div id="dashboardView" class="dashboard-view">
            <div class="page-hero">
                <h1 class="page-title" data-i18n="dashboard.title">My Retrospectives</h1>
                <p class="page-subtitle" data-i18n="dashboard.subtitle">Manage and join your team's retrospective boards
                </p>
            </div>

            <div class="page-controls">
                <div class="teams-nav-tabs">
                    <button class="team-nav-tab active" onclick="filterBoards('active')" id="filterActiveBtn"
                        data-i18n="tab.active">Active</button>
                    <button class="team-nav-tab" onclick="filterBoards('finished')" id="filterFinishedBtn"
                        data-i18n="tab.finalized">Finalized</button>
                </div>
            </div>

            <!-- Search and Custom Filters -->
            <div class="dashboard-filters-container">
                <input type="text" id="boardSearchInput" class="search-input-premium" placeholder="Search boards...">

                <div class="filter-toggles">
                    <button class="filter-toggle" id="myBoardsToggle" data-filter="myBoards">
                        üìã My Boards
                    </button>
                    <button class="filter-toggle" id="participantToggle" data-filter="participant">
                        üë§ I'm Participating
                    </button>
                    <button class="filter-toggle" id="teamBoardsToggle" data-filter="teamBoards">
                        üõ°Ô∏è Team Boards
                    </button>
                    <button class="btn-link" id="clearFiltersBtn" style="display: none;">
                        Clear Filters
                    </button>
                    <div class="active-filters-badge" id="activeFiltersBadge" style="display: none;">
                        <span id="activeFiltersCount">0</span> filters active
                    </div>
                </div>
            </div>

            <div id="dashboardGrid" class="dashboard-grid">
                <!-- Boards will be loaded here -->
            </div>

            <div id="emptyDashboard" class="welcome-screen" style="display: none;">
                <div class="welcome-content">
                    <h2 data-i18n="msg.no_boards">No Boards Yet</h2>
                    <p data-i18n="msg.click_new_board">Click "+ New Board" in the header to create your first
                        retrospective.</p>

                </div>
            </div>
        </div>

        <!-- Action Items View -->
        <div id="actionItemsView" class="dashboard-view" style="display: none;">
            <div class="page-hero">
                <h1 class="page-title" data-i18n="heading.action_items">My Action Items</h1>
                <p class="page-subtitle" data-i18n="action.subtitle">Track and manage your tasks across all
                    retrospectives</p>
            </div>
            <div id="actionItemsList" class="action-items-container">
                <!-- Items table will be loaded here -->
            </div>
        </div>

        <!-- Teams View -->
        <div id="teamsView" class="dashboard-view" style="display: none;">
            <div class="page-hero">
                <h1 class="page-title">Teams</h1>
                <p class="page-subtitle">Collaborate and manage your squads</p>
            </div>

            <!-- Teams Navigation Tabs -->
            <div class="teams-nav-tabs">
                <button class="team-nav-tab active" onclick="switchTeamTab('myTeams')" id="tabMyTeams">My Teams</button>
                <button class="team-nav-tab" onclick="switchTeamTab('exploreTeams')" id="tabExploreTeams">Explore
                    Teams</button>
            </div>

            <!-- My Teams Content -->
            <div id="myTeamsContent" class="team-tab-content">
                <div class="page-controls" style="margin-bottom: 2rem;">
                    <button class="btn btn-primary" onclick="openCreateTeamModal()">
                        <span style="font-size: 1.2rem;">+</span> Create New Team
                    </button>
                </div>
                <div id="teamsList" class="teams-grid">
                    <!-- My Teams loaded here -->
                </div>
            </div>

            <!-- Explore Teams Content -->
            <div id="exploreTeamsContent" class="team-tab-content" style="display: none;">
                <div class="page-controls">
                    <!-- Optional: Search bar for teams could go here in future -->
                </div>
                <div id="availableTeamsList" class="teams-grid">
                    <!-- Available teams loaded here -->
                </div>
            </div>
        </div>

        <!-- Team Details View -->
        <div id="teamDetailsView" class="dashboard-view" style="display: none;">
            <div id="teamDetailsContent">
                <!-- Team details loaded here -->
            </div>
        </div>

        <!-- Create Team Modal -->
        <div id="createTeamModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeCreateTeamModal()">&times;</span>
                <h2>Create New Team</h2>
                <form onsubmit="handleCreateTeam(event)">
                    <div class="form-group">
                        <label for="createTeamName">Team Name</label>
                        <input type="text" id="createTeamName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="createTeamDesc">Description (Optional)</label>
                        <textarea id="createTeamDesc" class="form-input" rows="3"></textarea>
                    </div>
                    <div class="form-group checkbox-group"
                        style="display: flex; align-items: center; gap: 0.5rem; margin-top: 1rem;">
                        <input type="checkbox" id="createTeamInviteOnly" style="width: auto;">
                        <label for="createTeamInviteOnly" style="margin: 0; cursor: pointer;">Invite Only (Users cannot
                            join without being added)</label>
                    </div>
                    <div class="modal-footer"
                        style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" onclick="closeCreateTeamModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Team</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Member Modal -->
        <div id="addMemberModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeAddMemberModal()">&times;</span>
                <h2>Add Team Member</h2>
                <form onsubmit="handleAddMember(event)">
                    <div class="form-group" style="position: relative;">
                        <label for="addMemberSearch">Search User (Name or Email)</label>
                        <input type="text" id="addMemberSearch" class="form-input" placeholder="Type to search..."
                            autocomplete="off" oninput="handleUserSearch(this.value)">
                        <div id="userSearchResults" class="search-results-dropdown" style="display: none;"></div>
                        <input type="hidden" id="selectedMemberEmail">
                    </div>
                    <!-- Fallback or explicit email entry handled by search selection -->

                    <div class="modal-footer"
                        style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" onclick="closeAddMemberModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary" id="btnAddMemberSubmit" disabled>Add
                            Member</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Team Modal -->
        <div id="editTeamModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeEditTeamModal()">&times;</span>
                <h2>Edit Team</h2>
                <form onsubmit="handleEditTeam(event)">
                    <div class="form-group">
                        <label for="editTeamName">Team Name</label>
                        <input type="text" id="editTeamName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="editTeamDesc">Description</label>
                        <textarea id="editTeamDesc" class="form-input" rows="3"></textarea>
                    </div>
                    <div class="form-group checkbox-group"
                        style="display: flex; align-items: center; gap: 0.5rem; margin-top: 1rem;">
                        <input type="checkbox" id="editTeamInviteOnly" style="width: auto;">
                        <label for="editTeamInviteOnly" style="margin: 0; cursor: pointer;">Invite Only (Users cannot
                            join without being added)</label>
                    </div>
                    <div class="modal-footer"
                        style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" onclick="closeEditTeamModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    </form>
    </div>
    </div>

    <!-- Admin View -->
    <div id="adminView" class="dashboard-view" style="display: none;">
        <div id="adminContent" class="admin-container">
            <!-- Admin Content Loaded Here -->
        </div>
    </div>

    <!-- Board View -->
    <div id="boardContainer" class="board-container" style="display: none;">
        <div id="readOnlyBanner" class="read-only-banner" style="display: none;" data-i18n="banner.read_only">
            ‚ö†Ô∏è This board is finished (Read Only)
        </div>

        <div class="board-header-container">
            <!-- Row 1: Title -->
            <div class="header-title-row">
                <h2 id="boardTitle" class="board-title"></h2>

                <!-- Participants Display -->
                <div id="boardParticipantsDisplay" class="board-participants-row"></div>
            </div>

            <!-- Row 2: Grid Content -->
            <div class="header-content-grid">

                <!-- Col 1: Phase, Users, Teams (Minimalist) -->
                <div class="header-section info-section"
                    style="flex-direction: row; gap: 1rem; align-items: center; padding-left: 1rem;">

                    <!-- Phase (Icon only if active, or minimal text) -->
                    <div class="info-card minimal" title="Current Status">
                        <div class="phase-info-group" style="display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-hourglass-half" style="color: var(--primary); font-size: 1.2rem;"></i>
                            <span id="currentPhase" style="font-weight: bold; font-size: 1.1rem;"></span>
                        </div>
                    </div>

                    <div style="display: none;">
                        <div style="width: 1px; height: 30px; background: var(--glass-border);"></div>

                        <!-- Participants Icon + Count -->
                        <div class="info-card minimal" id="participantsCard">
                            <div class="info-summary">
                                <i class="fas fa-user-friends"
                                    style="font-size: 1.2rem; color: var(--text-secondary);"></i>
                                <span id="participantsCount" style="font-size: 1.1rem; font-weight: bold;">0</span>
                            </div>
                            <div class="info-tooltip" id="participantsTooltip"></div>
                        </div>

                        <!-- Teams Icon + Count -->
                        <div class="info-card minimal" id="teamsCard">
                            <div class="info-summary">
                                <i class="fas fa-shield-alt"
                                    style="font-size: 1.2rem; color: var(--text-secondary);"></i>
                                <span id="teamsCount" style="font-size: 1.1rem; font-weight: bold;">0</span>
                            </div>
                            <div class="info-tooltip" id="teamsTooltip"></div>
                        </div>
                    </div>
                </div>

                <!-- Col 2: Timer & Control -->
                <div class="header-section timer-section-grid">

                    <div class="timer-row">
                        <span id="timerDisplay" class="timer-text">00:00</span>

                        <div class="timer-controls-group">
                            <input type="number" id="timerMinutes" class="timer-input" placeholder="Min" min="1"
                                max="60" value="5">
                            <span style="opacity:0.5; font-size:0.8rem">min</span>
                            <div style="width: 1px; height: 20px; background: var(--glass-border); margin: 0 5px;">
                            </div>
                            <button id="startTimerBtn" class="btn btn-success icon-btn"
                                style="display: none; width:32px; height:32px; padding:0; justify-content:center; align-items:center;"
                                data-action="startTimer" title="Start"><i class="fas fa-play"
                                    style="font-size:0.9rem"></i></button>
                            <button id="stopTimerBtn" class="btn btn-danger icon-btn"
                                style="display: none; width:32px; height:32px; padding:0; justify-content:center; align-items:center;"
                                data-action="stopTimer" title="Stop"><i class="fas fa-stop"
                                    style="font-size:0.9rem"></i></button>
                        </div>
                    </div>

                    <!-- Phase Switch -->
                    <button id="switchPhaseBtn" class="btn btn-secondary"
                        style="width: 100%; margin-top: auto; font-size: 0.9rem; display:flex; justify-content:center; align-items:center; gap:0.5rem;"
                        data-action="switchPhase"><i class="fas fa-exchange-alt"></i> Phase</button>

                    <div id="voteStatusDisplay" class="vote-status-display"
                        style="display:none; text-align: center; margin-top: 5px;"></div>
                </div>

                <!-- Col 3: Actions Grid -->
                <div class="header-section actions-section">
                    <h5 style="margin:0; opacity:0.7; font-size:0.8rem; margin-bottom:0.5rem; letter-spacing: 1px;">
                        ACTIONS</h5>
                    <div class="actions-grid"
                        style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;">
                        <!-- Host Claims -->
                        <button id="claimManagerBtn" class="btn btn-primary" data-action="claimManager"
                            style="display: none;" title="Claim Host"><i class="fas fa-crown"></i></button>
                        <button id="unclaimManagerBtn" class="btn btn-outline" data-action="unclaimManager"
                            style="display: none;" title="Unclaim"><i class="fas fa-user-slash"></i></button>

                        <!-- Tools -->
                        <button id="addColumnBtn" class="btn btn-primary" style="display: none;" data-action="addColumn"
                            title="Add Column"><i class="fas fa-plus"></i></button>
                        <button id="manageTeamsBtn" class="btn btn-secondary" style="display: none;"
                            data-action="manageTeams" title="Manage Teams"><i class="fas fa-users-cog"></i></button>
                        <button id="adminSettingsBtn" class="btn btn-secondary" style="display: none;"
                            data-action="openSettings" title="Board Settings"><i class="fas fa-cog"></i></button>
                        <button id="exportBoardBtn" class="btn btn-secondary" data-action="exportBoard"
                            style="display: none;" title="Export CSV"><i class="fas fa-file-csv"></i></button>

                        <!-- Meta -->
                        <button id="finishRetroBtn" class="btn btn-danger" style="display: none;"
                            data-action="finishRetro" title="Finish Retro"><i
                                class="fas fa-flag-checkered"></i></button>
                        <button id="reopenRetroBtn" class="btn btn-primary" style="display: none;"
                            data-action="reopenRetro" title="Reopen Retro"><i class="fas fa-door-open"></i></button>
                        <button id="leaveBoardBtn" class="btn btn-danger" style="display: none;"
                            data-action="leaveBoard" title="Leave Board"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
                </div>
            </div>

        </div>

        <!-- Columns Section -->
        <div id="columnsContainer" class="columns-container">
            <!-- Columns will be dynamically added here -->
        </div>
    </div>
    </div> <!-- End .container -->

    <div id="appSidebar" class="app-sidebar">
        <ul id="menuList" class="menu-list"></ul>
        <div class="sidebar-footer">
            <small>BenTro <span id="appVersionFooter"></span></small>
        </div>
    </div>
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Auth Modals -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2 data-i18n="btn.login">Login</h2>
            <form onsubmit="handleLoginSubmit(event)">
                <div class="form-group">
                    <label data-i18n="label.email">Email</label>
                    <input type="email" id="loginEmail" class="form-input" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label data-i18n="label.password">Password</label>
                    <input type="password" id="loginPassword" class="form-input" required
                        autocomplete="current-password">
                </div>
                <div class="modal-footer"
                    style="display: flex; align-items: center; justify-content: space-between; margin-top: 1.5rem;">
                    <a href="#" onclick="switchToRegister()" style="font-size: 0.9rem;">Need an account?
                        Register</a>
                    <button type="submit" class="btn btn-primary" data-i18n="btn.login">Login</button>
                </div>
            </form>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRegisterModal()">&times;</span>
            <h2>Register</h2>
            <form onsubmit="handleRegisterSubmit(event)">
                <div class="form-group" style="display: flex; gap: 1rem;">
                    <div style="flex: 1;">
                        <label data-i18n="label.first_name">First Name</label> <span style="color:red">*</span>
                        <input type="text" id="regFirstName" class="form-input" required>
                    </div>
                    <div style="flex: 1;">
                        <label data-i18n="label.last_name">Last Name</label> <span style="color:red">*</span>
                        <input type="text" id="regLastName" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label data-i18n="label.email">Email</label> <span style="color:red">*</span>
                    <input type="email" id="regEmail" class="form-input" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label data-i18n="label.password">Password</label> <span style="color:red">*</span>
                    <input type="password" id="regPassword" class="form-input" required autocomplete="new-password"
                        minlength="6" placeholder="Min. 6 characters">
                </div>

                <div class="form-group">
                    <label data-i18n="label.choose_avatar">Choose Your Avatar</label>
                    <div class="avatar-selector-container">
                        <div id="registerAvatarDisplay" class="current-avatar-large">üë§</div>
                        <div id="registerAvatarSelector" class="avatar-grid" style="display: none;"></div>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="toggleRegisterAvatarSelector()"
                            data-i18n="btn.change_avatar">Change Avatar</button>
                    </div>
                </div>
                <div class="modal-footer"
                    style="display: flex; align-items: center; justify-content: space-between; margin-top: 1.5rem;">
                    <a href="#" onclick="switchToLogin()" style="font-size: 0.9rem;">Have
                        an account? Login</a>
                    <button type="submit" class="btn btn-primary">Register</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modals Container (Loaded dynamically) -->
    <div id="modals-container"></div>
    <script type="module" src="/static/js/main.js?v=v0.14.5"></script>
</body>

</html>