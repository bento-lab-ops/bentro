=== RUN   TestRegister
[GIN] 2026/01/14 - 07:52:58 | 201 |     55.7429ms |                 | POST     "/register"

2026/01/14 07:52:58 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("7351c0fc-ecaf-4edb-b87d-299c67e20021","john@example.com","johndoe","$2a$10$VY7u.yVvl2PQLhvVAxXuMepT5.8l6RpbhLVvhyqhuXt8lUnhfzraa","John Doe","","user",false,"2026-01-14 07:52:58.736","2026-01-14 07:52:58.736","2026-01-14 07:52:58.736")
[GIN] 2026/01/14 - 07:52:58 | 409 |      48.473ms |                 | POST     "/register"
--- PASS: TestRegister (0.11s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:52:58 | 200 |     48.4011ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:52:58 | 401 |     45.7647ms |                 | POST     "/login"
--- PASS: TestLogin (0.14s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:52:58 | 401 |       659.2â”¬â•¡s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:52:58 | 200 |     52.3966ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:52:58 | 200 |      1.0896ms |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:52:59 | 200 |     47.7498ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:52:59 | 403 |            0s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:52:59 | 200 |     47.7177ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:52:59 | 200 |       789.9â”¬â•¡s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.14s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:52:59 | 200 |     48.5713ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:52:59 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "e612ac97-a7b2-418c-99e6-23b1121387a1" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:52:59 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:52:59 | 200 |     47.6409ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:52:59 | 401 |     47.9412ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:52:59 | 200 |     96.4644ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:52:59 | 200 |     47.1823ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.29s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:52:59 | 200 |     48.3015ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:52:59 | 200 |       866.1â”¬â•¡s |                 | PUT      "/admin/users/f80296e2-bd6a-462c-8a07-c26b831c25e5/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:52:59 | 200 |     48.1865ms |                 | POST     "/admin/users/f80296e2-bd6a-462c-8a07-c26b831c25e5/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | DELETE   "/admin/users/f80296e2-bd6a-462c-8a07-c26b831c25e5"

2026/01/14 07:52:59 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "f80296e2-bd6a-462c-8a07-c26b831c25e5" AND `users`.`id` = "f80296e2-bd6a-462c-8a07-c26b831c25e5" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.15s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:52:59 | 201 |       507.3â”¬â•¡s |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:52:59 | 201 |       508.3â”¬â•¡s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | GET      "/boards/da64ed5f-7e50-415e-8451-679cae5bba32"

2026/01/14 07:52:59 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:229 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "d733815e-5078-46dc-9e3f-01788c6c3e78" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:52:59 | 404 |            0s |                 | GET      "/boards/d733815e-5078-46dc-9e3f-01788c6c3e78"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 07:52:59 | 200 |       504.6â”¬â•¡s |                 | PUT      "/boards/b7cbfb3a-92d9-44f6-ab72-5bdbf1cd5ecc/status"
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | PUT      "/boards/b7cbfb3a-92d9-44f6-ab72-5bdbf1cd5ecc/status"
--- PASS: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | PUT      "/boards/7da87133-76fa-458b-87f9-a7c9ba1838d9"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board eb590de4-64fd-40f0-81f9-4d0efdcb892a.
[GIN] 2026/01/14 - 07:52:59 | 200 |       509.9â”¬â•¡s |                 | POST     "/boards/eb590de4-64fd-40f0-81f9-4d0efdcb892a/join"
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | POST     "/boards/eb590de4-64fd-40f0-81f9-4d0efdcb892a/leave"
[GIN] 2026/01/14 - 07:52:59 | 400 |            0s |                 | POST     "/boards/eb590de4-64fd-40f0-81f9-4d0efdcb892a/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:52:59 | 200 |       506.2â”¬â•¡s |                 | POST     "/boards/3d1bc2a5-e828-4452-96e6-4178d096501a/claim"
[GIN] 2026/01/14 - 07:52:59 | 200 |         505â”¬â•¡s |                 | POST     "/boards/3d1bc2a5-e828-4452-96e6-4178d096501a/claim"
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | POST     "/boards/3d1bc2a5-e828-4452-96e6-4178d096501a/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | DELETE   "/boards/b7f33392-949b-493b-87ec-4d25fbc2f393"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestColumnCRUD
[GIN] 2026/01/14 - 07:52:59 | 201 |       506.9â”¬â•¡s |                 | POST     "/boards/d857728b-14ab-4dc4-9544-e5fa98ec6ead/columns"
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | PUT      "/columns/5a2a1aaa-53ce-4cb0-af11-9d5c3d001093"
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | PUT      "/columns/5a2a1aaa-53ce-4cb0-af11-9d5c3d001093/position"
[GIN] 2026/01/14 - 07:52:59 | 201 |            0s |                 | POST     "/boards/d857728b-14ab-4dc4-9544-e5fa98ec6ead/columns"
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | DELETE   "/columns/5a2a1aaa-53ce-4cb0-af11-9d5c3d001093"
--- PASS: TestColumnCRUD (0.00s)
=== RUN   TestCardCRUD
[GIN] 2026/01/14 - 07:52:59 | 201 |            0s |                 | POST     "/columns/e68656e9-b20e-410b-a2d7-40a07f4a1e50/cards"
[GIN] 2026/01/14 - 07:52:59 | 200 |         505â”¬â•¡s |                 | PUT      "/cards/3d3ae79c-abba-411b-aa0b-fb3ba6f05e65"
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | DELETE   "/cards/3d3ae79c-abba-411b-aa0b-fb3ba6f05e65"
--- PASS: TestCardCRUD (0.00s)
=== RUN   TestMoveCard
[GIN] 2026/01/14 - 07:52:59 | 200 |       509.9â”¬â•¡s |                 | PUT      "/cards/83e523e8-0bf0-404e-809a-195cba822a59/move"
--- PASS: TestMoveCard (0.00s)
=== RUN   TestMergeAndUnmergeCard
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | POST     "/cards/508e3eed-33ca-408a-a3c5-90b8b1f73f44/merge"
[GIN] 2026/01/14 - 07:52:59 | 200 |            0s |                 | POST     "/cards/508e3eed-33ca-408a-a3c5-90b8b1f73f44/unmerge"
--- PASS: TestMergeAndUnmergeCard (0.00s)
=== RUN   TestSadPaths
[GIN] 2026/01/14 - 07:52:59 | 400 |            0s |       192.0.2.1 | PUT      "/columns/invalid-uuid"

2026/01/14 07:52:59 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/column_handler.go:75 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `columns` WHERE `columns`.`id` = "3c13a2f3-d647-42e8-949c-140fa4caad44" AND `columns`.`deleted_at` IS NULL ORDER BY `columns`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:52:59 | 404 |            0s |       192.0.2.1 | PUT      "/columns/3c13a2f3-d647-42e8-949c-140fa4caad44"

2026/01/14 07:52:59 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/card_handler.go:171 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `cards` WHERE `cards`.`id` = "072b3dbb-7134-4920-b6d4-ce4a1d3ceee4" AND `cards`.`deleted_at` IS NULL ORDER BY `cards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:52:59 | 404 |            0s |                 | POST     "/cards/8fc9fdee-65a5-4e16-9abe-5465ffa4d4ed/merge"
--- PASS: TestSadPaths (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:52:59 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.10s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.11s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:52:59 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
PASS
ok  	retro-app/internal/handlers	1.488s
