=== RUN   TestRegister
[GIN] 2026/01/14 - 07:41:09 | 201 |     50.6877ms |                 | POST     "/register"

2026/01/14 07:41:09 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("f6e27ca2-2b9d-43b3-8f55-167fbedd36bb","john@example.com","johndoe","$2a$10$ZOU.rqZUo/6qY0ue9rZMXOThO98aY5yJrRJsdTe75GyqVCoxFBw/a","John Doe","","user",false,"2026-01-14 07:41:09.09","2026-01-14 07:41:09.09","2026-01-14 07:41:09.09")
[GIN] 2026/01/14 - 07:41:09 | 409 |     47.8214ms |                 | POST     "/register"
--- PASS: TestRegister (0.10s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:41:09 | 200 |     48.1179ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:41:09 | 401 |     46.9916ms |                 | POST     "/login"
--- PASS: TestLogin (0.14s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:41:09 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:41:09 | 200 |     48.9148ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:41:09 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:41:09 | 200 |     47.8067ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:41:09 | 403 |      1.3703ms |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:41:09 | 200 |     51.0682ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:41:09 | 200 |            0s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.15s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:41:09 | 200 |     49.0864ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:41:09 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "3e99077a-78f8-4d8e-bfa2-d82d22bd8ae7" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:41:09 | 200 |       539.7â”¬â•¡s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:41:09 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:41:09 | 200 |     47.6883ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:41:09 | 401 |     46.5044ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:41:09 | 200 |      96.863ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:41:09 | 200 |     48.4182ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.29s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:41:09 | 200 |     46.2092ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:41:09 | 200 |            0s |                 | PUT      "/admin/users/ad139f74-94bb-4e5c-b9f1-20395730c3a7/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:41:10 | 200 |     48.7255ms |                 | POST     "/admin/users/ad139f74-94bb-4e5c-b9f1-20395730c3a7/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | DELETE   "/admin/users/ad139f74-94bb-4e5c-b9f1-20395730c3a7"

2026/01/14 07:41:10 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "ad139f74-94bb-4e5c-b9f1-20395730c3a7" AND `users`.`id` = "ad139f74-94bb-4e5c-b9f1-20395730c3a7" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.16s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:41:10 | 201 |            0s |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:41:10 | 201 |       1.011ms |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | GET      "/boards/2bf4bc7e-7024-4029-bc72-2f0ee13e937b"

2026/01/14 07:41:10 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:232 [35;1mrecord not found
[0m[33m[0.647ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "2e273c34-bcc7-4ca5-a4e9-50e61c09ad25" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:41:10 | 404 |       647.1â”¬â•¡s |                 | GET      "/boards/2e273c34-bcc7-4ca5-a4e9-50e61c09ad25"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
DEBUG: Saved board status: finished, FinishedAt: 2026-01-14 07:41:10.0413224 -0300 -03 m=+1.062229701
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | PUT      "/boards/06cf56ee-fa59-4228-8249-d3bcc632f0d1/status"
DEBUG: Setting FinishedAt to nil for active status
DEBUG: Saved board status: active, FinishedAt: <nil>
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | PUT      "/boards/06cf56ee-fa59-4228-8249-d3bcc632f0d1/status"
    board_handler_test.go:179: 
        	Error Trace:	C:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler_test.go:179
        	Error:      	Expected nil, but got: time.Date(2026, time.January, 14, 7, 41, 10, 41322400, time.Location(""))
        	Test:       	TestUpdateBoardStatus
--- FAIL: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | PUT      "/boards/84e8cb5a-ce1f-4a97-958a-2a122a488e4d"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board 736e6067-fd03-40bc-af53-5a722a7097e5.
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | POST     "/boards/736e6067-fd03-40bc-af53-5a722a7097e5/join"
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | POST     "/boards/736e6067-fd03-40bc-af53-5a722a7097e5/leave"
[GIN] 2026/01/14 - 07:41:10 | 400 |            0s |                 | POST     "/boards/736e6067-fd03-40bc-af53-5a722a7097e5/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | POST     "/boards/a9d5cec6-409e-4132-a247-d7e9caea9850/claim"
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | POST     "/boards/a9d5cec6-409e-4132-a247-d7e9caea9850/claim"
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | POST     "/boards/a9d5cec6-409e-4132-a247-d7e9caea9850/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:41:10 | 200 |            0s |                 | DELETE   "/boards/ad574afd-6671-4c43-af1d-8ff17fd1c433"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:41:10 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.09s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.11s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:41:10 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
FAIL
FAIL	retro-app/internal/handlers	1.498s
FAIL
