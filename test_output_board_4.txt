=== RUN   TestRegister
[GIN] 2026/01/14 - 07:42:46 | 201 |     54.5737ms |                 | POST     "/register"

2026/01/14 07:42:46 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("4c304472-8aec-40e8-a18a-6d0ba4ef9752","john@example.com","johndoe","$2a$10$Emg7Ep0RQmSnTw5PmXQhJe2mLh3L0hzwA73FvkDPasWDUBW7vYA4m","John Doe","","user",false,"2026-01-14 07:42:46.393","2026-01-14 07:42:46.393","2026-01-14 07:42:46.393")
[GIN] 2026/01/14 - 07:42:46 | 409 |     50.3949ms |                 | POST     "/register"
--- PASS: TestRegister (0.11s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:42:46 | 200 |     55.5076ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:42:46 | 401 |     48.7395ms |                 | POST     "/login"
--- PASS: TestLogin (0.16s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:42:46 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:42:46 | 200 |     47.5277ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:42:46 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:42:46 | 200 |     48.8173ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:42:46 | 403 |            0s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:42:46 | 200 |     47.9688ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:42:46 | 200 |       592.1â”¬â•¡s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.15s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:42:46 | 200 |     47.8276ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:42:46 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "3c113a87-e430-4af6-b8b3-7c62d5a325a5" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:42:46 | 200 |       321.4â”¬â•¡s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:42:46 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:42:46 | 200 |     47.8573ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:42:47 | 401 |     47.1741ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:42:47 | 200 |     97.4026ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:42:47 | 200 |     47.5302ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.29s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:42:47 | 200 |      47.313ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:42:47 | 200 |       661.3â”¬â•¡s |                 | PUT      "/admin/users/ce5a134b-78a8-450f-8ff0-7edd41c05a85/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:42:47 | 200 |     57.6118ms |                 | POST     "/admin/users/ce5a134b-78a8-450f-8ff0-7edd41c05a85/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | DELETE   "/admin/users/ce5a134b-78a8-450f-8ff0-7edd41c05a85"

2026/01/14 07:42:47 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "ce5a134b-78a8-450f-8ff0-7edd41c05a85" AND `users`.`id` = "ce5a134b-78a8-450f-8ff0-7edd41c05a85" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.16s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:42:47 | 201 |        1.15ms |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:42:47 | 201 |            0s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | GET      "/boards/551666fa-f239-4269-a789-eda8f269dfcf"

2026/01/14 07:42:47 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:232 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "3c62e8ab-0cda-422e-a66c-01b94094102c" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:42:47 | 404 |       606.5â”¬â•¡s |                 | GET      "/boards/3c62e8ab-0cda-422e-a66c-01b94094102c"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
DEBUG: Saved board status: finished, FinishedAt: 2026-01-14 07:42:47.3484106 -0300 -03 m=+1.074842801
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | PUT      "/boards/50375fd7-c124-44b4-99a5-1f608c56da17/status"
DEBUG: Setting FinishedAt to nil for active status
DEBUG: Saved board status: active, FinishedAt: <nil>
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | PUT      "/boards/50375fd7-c124-44b4-99a5-1f608c56da17/status"
--- PASS: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | PUT      "/boards/c2c7e7bf-b5d6-4ff3-9915-07079edcec28"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board fc741a8d-4163-4816-94c6-c2b58e5ac4e4.
[GIN] 2026/01/14 - 07:42:47 | 200 |       641.9â”¬â•¡s |                 | POST     "/boards/fc741a8d-4163-4816-94c6-c2b58e5ac4e4/join"
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | POST     "/boards/fc741a8d-4163-4816-94c6-c2b58e5ac4e4/leave"
[GIN] 2026/01/14 - 07:42:47 | 400 |            0s |                 | POST     "/boards/fc741a8d-4163-4816-94c6-c2b58e5ac4e4/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | POST     "/boards/37f6b386-bd47-4075-9cbe-220b297356e2/claim"
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | POST     "/boards/37f6b386-bd47-4075-9cbe-220b297356e2/claim"
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | POST     "/boards/37f6b386-bd47-4075-9cbe-220b297356e2/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:42:47 | 200 |            0s |                 | DELETE   "/boards/1783e030-24cd-4d55-b3b0-242aba46389c"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:42:47 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.09s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.11s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:42:47 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.11s)
PASS
ok  	retro-app/internal/handlers	1.520s
