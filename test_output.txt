=== RUN   TestRegister
[GIN] 2026/01/14 - 07:32:42 | 201 |     50.2412ms |                 | POST     "/register"
[GIN] 2026/01/14 - 07:32:42 | 400 |            0s |                 | POST     "/register"
    auth_handler_test.go:91: 
        	Error Trace:	C:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:91
        	Error:      	Not equal: 
        	            	expected: 409
        	            	actual  : 400
        	Test:       	TestRegister
--- FAIL: TestRegister (0.05s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:32:43 | 200 |     58.4619ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:32:43 | 401 |     51.0558ms |                 | POST     "/login"
--- PASS: TestLogin (0.16s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:32:43 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:32:43 | 200 |     46.9324ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:32:43 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:32:43 | 200 |     49.3307ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:32:43 | 403 |            0s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:32:43 | 200 |     47.5114ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:32:43 | 200 |       302.4Âµs |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.15s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:32:43 | 200 |     53.8317ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:32:43 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "83fbfa0e-b0da-4d50-96d1-0612c27de97d" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:32:43 | 200 |            0s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:32:43 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:32:43 | 200 |     57.2824ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:32:43 | 401 |     55.1923ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:32:43 | 200 |    106.2638ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:32:43 | 200 |     50.1672ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.32s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:32:43 | 200 |     47.5348ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:32:43 | 200 |            0s |                 | PUT      "/admin/users/12431772-00fb-4aa9-823e-403cd18fac81/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:32:43 | 200 |     52.6381ms |                 | POST     "/admin/users/12431772-00fb-4aa9-823e-403cd18fac81/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:32:43 | 200 |            0s |                 | DELETE   "/admin/users/12431772-00fb-4aa9-823e-403cd18fac81"

2026/01/14 07:32:43 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:331 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "12431772-00fb-4aa9-823e-403cd18fac81" AND `users`.`id` = "12431772-00fb-4aa9-823e-403cd18fac81" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.15s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:32:43 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:32:43 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
âš  ADMIN_PASSWORD not set, using default: bentro
âœ“ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.12s)
=== RUN   TestEnsureAdminUser_AlreadyExists
âœ“ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.10s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:32:44 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
âœ“ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
FAIL
FAIL	retro-app/internal/handlers	1.488s
FAIL
