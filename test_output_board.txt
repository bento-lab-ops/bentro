=== RUN   TestRegister
[GIN] 2026/01/14 - 07:38:43 | 201 |     51.0566ms |                 | POST     "/register"

2026/01/14 07:38:43 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:69 [35;1mconstraint failed: UNIQUE constraint failed: users.email (2067)
[0m[33m[0.000ms] [34;1m[rows:0][0m INSERT INTO `users` (`id`,`email`,`display_name`,`password_hash`,`name`,`avatar_url`,`role`,`require_password_change`,`last_login`,`created_at`,`updated_at`) VALUES ("0555c3a4-cecf-4041-af67-c119b5cc280f","john@example.com","johndoe","$2a$10$y1s7i1Fd3c3ZbcoA4GFx9.6JLrXXLNBMF48v8l0FteDxnntw8AV/G","John Doe","","user",false,"2026-01-14 07:38:43.717","2026-01-14 07:38:43.717","2026-01-14 07:38:43.717")
[GIN] 2026/01/14 - 07:38:43 | 409 |     51.6473ms |                 | POST     "/register"
--- PASS: TestRegister (0.11s)
=== RUN   TestLogin
[GIN] 2026/01/14 - 07:38:43 | 200 |     50.5744ms |                 | POST     "/login"
[GIN] 2026/01/14 - 07:38:43 | 401 |     47.0273ms |                 | POST     "/login"
--- PASS: TestLogin (0.15s)
=== RUN   TestAuthMiddleware
AuthMiddleware: No token found
[GIN] 2026/01/14 - 07:38:43 | 401 |            0s |                 | GET      "/me"
[GIN] 2026/01/14 - 07:38:43 | 200 |     48.6471ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: me@test.com
[GIN] 2026/01/14 - 07:38:43 | 200 |            0s |                 | GET      "/me"
--- PASS: TestAuthMiddleware (0.10s)
=== RUN   TestAdminMiddleware
[GIN] 2026/01/14 - 07:38:44 | 200 |     51.1215ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: user@test.com
AdminMiddleware - role exists: true, role value: user
[GIN] 2026/01/14 - 07:38:44 | 403 |       471.7â”¬â•¡s |                 | GET      "/admin/users"
[GIN] 2026/01/14 - 07:38:44 | 200 |     47.7291ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: admin@test.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:38:44 | 200 |       946.9â”¬â•¡s |                 | GET      "/admin/users"
--- PASS: TestAdminMiddleware (0.15s)
=== RUN   TestUpdateProfile
[GIN] 2026/01/14 - 07:38:44 | 200 |     48.3584ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: u@t.com

2026/01/14 07:38:44 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler.go:213 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE display_name = "newname" AND id != "40a4faf7-d72b-4926-994a-2f16f39ba6b9" ORDER BY `users`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:38:44 | 200 |       506.4â”¬â•¡s |                 | PUT      "/profile"
AuthMiddleware: Setting user_role to: user for user: u@t.com
[GIN] 2026/01/14 - 07:38:44 | 409 |            0s |                 | PUT      "/profile"
--- PASS: TestUpdateProfile (0.10s)
=== RUN   TestChangePassword
[GIN] 2026/01/14 - 07:38:44 | 200 |     54.5224ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:38:44 | 401 |     47.4019ms |                 | POST     "/change-password"
AuthMiddleware: Setting user_role to: user for user: cp@t.com
[GIN] 2026/01/14 - 07:38:44 | 200 |    105.9606ms |                 | POST     "/change-password"
[GIN] 2026/01/14 - 07:38:44 | 200 |      49.822ms |                 | POST     "/login"
--- PASS: TestChangePassword (0.31s)
=== RUN   TestAdminUserManagement
[GIN] 2026/01/14 - 07:38:44 | 200 |     55.9041ms |                 | POST     "/login"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:38:44 | 200 |       842.3â”¬â•¡s |                 | PUT      "/admin/users/c8b23838-1c84-469f-b53a-e0535bc3f686/role"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:38:44 | 200 |     48.4399ms |                 | POST     "/admin/users/c8b23838-1c84-469f-b53a-e0535bc3f686/reset-password"
AuthMiddleware: Setting user_role to: admin for user: adm@t.com
AdminMiddleware - role exists: true, role value: admin
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | DELETE   "/admin/users/c8b23838-1c84-469f-b53a-e0535bc3f686"

2026/01/14 07:38:44 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/auth_handler_test.go:332 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE id = "c8b23838-1c84-469f-b53a-e0535bc3f686" AND `users`.`id` = "c8b23838-1c84-469f-b53a-e0535bc3f686" ORDER BY `users`.`id` LIMIT 1
--- PASS: TestAdminUserManagement (0.16s)
=== RUN   TestLogout
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | POST     "/logout"
--- PASS: TestLogout (0.00s)
=== RUN   TestCreateBoard
[GIN] 2026/01/14 - 07:38:44 | 201 |      1.0143ms |                 | POST     "/boards"
[GIN] 2026/01/14 - 07:38:44 | 201 |            0s |                 | POST     "/boards"
--- PASS: TestCreateBoard (0.00s)
=== RUN   TestGetBoard
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | GET      "/boards/eb4cc428-4088-4b37-bc53-04d380ca5963"

2026/01/14 07:38:44 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler.go:228 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `boards` WHERE `boards`.`id` = "085331a1-d5f0-40d6-9209-3a6163eef0f7" AND `boards`.`deleted_at` IS NULL ORDER BY `boards`.`id` LIMIT 1
[GIN] 2026/01/14 - 07:38:44 | 404 |            0s |                 | GET      "/boards/085331a1-d5f0-40d6-9209-3a6163eef0f7"
--- PASS: TestGetBoard (0.00s)
=== RUN   TestUpdateBoardStatus
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | PUT      "/boards/be0e64bd-7e1f-49c7-804b-060ade4255ff/status"
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | PUT      "/boards/be0e64bd-7e1f-49c7-804b-060ade4255ff/status"
    board_handler_test.go:179: 
        	Error Trace:	C:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/board_handler_test.go:179
        	Error:      	Expected nil, but got: time.Date(2026, time.January, 14, 7, 38, 44, 689342500, time.Location(""))
        	Test:       	TestUpdateBoardStatus
--- FAIL: TestUpdateBoardStatus (0.00s)
=== RUN   TestUpdateBoardSettings
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | PUT      "/boards/4d38ac51-fe16-4049-b26d-3b87f4bdfe69"
--- PASS: TestUpdateBoardSettings (0.00s)
=== RUN   TestJoinAndLeaveBoard
[JoinBoard] User user1 joined board 52d303a7-6169-4eae-b8f8-5142ebb23e7a.
[GIN] 2026/01/14 - 07:38:44 | 200 |       346.1â”¬â•¡s |                 | POST     "/boards/52d303a7-6169-4eae-b8f8-5142ebb23e7a/join"
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | POST     "/boards/52d303a7-6169-4eae-b8f8-5142ebb23e7a/leave"
[GIN] 2026/01/14 - 07:38:44 | 400 |            0s |                 | POST     "/boards/52d303a7-6169-4eae-b8f8-5142ebb23e7a/join"
--- PASS: TestJoinAndLeaveBoard (0.00s)
=== RUN   TestClaimAndUnclaimBoard
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | POST     "/boards/6d0716bf-6fd9-4603-ae9d-a4f91e576296/claim"
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | POST     "/boards/6d0716bf-6fd9-4603-ae9d-a4f91e576296/claim"
[GIN] 2026/01/14 - 07:38:44 | 200 |       688.2â”¬â•¡s |                 | POST     "/boards/6d0716bf-6fd9-4603-ae9d-a4f91e576296/unclaim"
--- PASS: TestClaimAndUnclaimBoard (0.00s)
=== RUN   TestDeleteBoard
[GIN] 2026/01/14 - 07:38:44 | 200 |            0s |                 | DELETE   "/boards/c8fbf7b6-1ab2-45fe-94e4-5f33b1da16a7"
--- PASS: TestDeleteBoard (0.00s)
=== RUN   TestEnsureAdminUser_CreateNew

2026/01/14 07:38:44 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“ÃœÃ¡ ADMIN_PASSWORD not set, using default: bentro
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CreateNew (0.10s)
=== RUN   TestEnsureAdminUser_AlreadyExists
Î“Â£Ã´ Admin user already exists
--- PASS: TestEnsureAdminUser_AlreadyExists (0.10s)
=== RUN   TestEnsureAdminUser_CustomPassword

2026/01/14 07:38:44 [31;1mC:/Users/danbn/.gemini/antigravity/scratch/retro-app/internal/handlers/init_admin.go:17 [35;1mrecord not found
[0m[33m[0.000ms] [34;1m[rows:0][0m SELECT * FROM `users` WHERE email = "admin@system.local" ORDER BY `users`.`id` LIMIT 1
Î“Â£Ã´ Admin user created successfully (email: admin@system.local)
--- PASS: TestEnsureAdminUser_CustomPassword (0.10s)
FAIL
FAIL	retro-app/internal/handlers	1.541s
FAIL
